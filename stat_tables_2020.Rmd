<br>  


## **2020 NCAA Stats**

<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>
# {.tabset}

```{r setup, include=FALSE}
#Load packages
easypackages::libraries("tidyverse", "httr", "reactable", "htmltools", "jsonlite", "readr", "dplyr", "magick", "stringr")

#color stuff for tables 
sticky_style <- list(position = "sticky", left = 0, background = "#fff", zIndex = 1,
                     borderRight = "1px solid #eee")
col_pal_good <- function(x) rgb(colorRamp(c("red3", "white", "forestgreen"))(x), maxColorValue = 255)
col_pal_bad <- function(x) rgb(colorRamp(c("forestgreen", "white", "red3"))(x), maxColorValue = 255)

my_api_key <-'5da2a45fee5e9b87fcbcc2fbca2944a9491ce0b462968498e8eae560b55b109e'

get_jwt <- POST("https://api.profootballfocus.com/auth/login",
                query=list('api_key'=my_api_key))
get_jwt
my_jwt <- content(get_jwt)$jwt[1]
# my_jwt

test <- GET(paste0('https://api.profootballfocus.com/v1/video/ncaa/2020/plays'),
            add_headers(Authorization = paste0('Bearer ', my_jwt),
                        'Accept-Encoding' = 'gzip',
                        'Content-Encoding' = 'gzip'),
             encode = "json")

test$status_code # as long as this says 200, you're good to go

df <- content(test, "text") %>% 
  fromJSON(flatten = T)

this.content.df <- do.call(what = "rbind",
                           args = lapply(df, as.data.frame))

this.content.df <- this.content.df[,sort(names(this.content.df))]

this.content.df <- this.content.df %>% arrange(game_id, play_id)
pbp <- this.content.df %>% arrange(game_id, play_id)

pbp$field_position <- as.numeric(pbp$field_position)
pbp$NewFPos = ifelse(pbp$field_position < 0, 100+pbp$field_position, pbp$field_position)
pbp$Gain.Loss = ifelse(pbp$no_play == 1, NA,
                                       ifelse(!is.na(pbp$interception), NA,
                                              ifelse(!is.na(pbp$fumble), pbp$gain_loss,
                                                     ifelse(!is.na(pbp$penalty), pbp$gain_loss,
                                                            pbp$gain_loss_net))))
pbp$DrivePlayNext = c(pbp$drive_play[-c(1)],0)
pbp$BigPlay = ifelse(pbp$Gain.Loss >= 15, 1, 0)
pbp$ChunkPlay = ifelse(pbp$Gain.Loss >= 10, 1,0)
pbp$TFL = ifelse(pbp$Gain.Loss < 0 & is.na(pbp$sack) & pbp$primary_run_concept != "UNDEFINED" & pbp$no_play != 1, 1, 0)
pbp$uniqueID = paste(pbp$game_id, pbp$offense, pbp$drive, sep="")
pbp$uniqueOpponentID = paste(pbp$game_id, pbp$defense, pbp$drive, sep="")
pbp$FieldZone = ifelse(pbp$NewFPos > 90, "CO",
                                       ifelse(pbp$NewFPos <= 90 & pbp$NewFPos > 40, "OF",
                                              ifelse(pbp$NewFPos <= 40 & pbp$NewFPos > 20, "SZ", "RZ")))
pbp$Down.Next = c(pbp$down[-c(1)],0)
pbp$Qtr.Next = c(pbp$quarter[-c(1)],0)
pbp$Is.Halftime = ifelse(pbp$quarter == 2 & pbp$Qtr.Next == 3, "Y", "N")
pbp$Is.EndGame = ifelse(pbp$quarter == 4 & pbp$Qtr.Next == 1, "Y", "N")
pbp$uniqueOffGameID = paste(pbp$game_id, pbp$offense, sep = ",")
pbp$uniqueDefGameID = paste(pbp$game_id, pbp$defense, sep = ",")
pbp$PassArea = ifelse(pbp$pass_depth < 0 & pbp$pass_zone %in% c("1L", "2L", "3L"), 1,
                ifelse(pbp$pass_depth < 0 & pbp$pass_zone %in% c("4"), 2,
                 ifelse(pbp$pass_depth < 0 & pbp$pass_zone %in% c("5R", "6R", "7R"), 3,
                  ifelse(pbp$pass_depth >= 0 & pbp$pass_depth < 5 & pbp$pass_zone %in% c("1L", "2L", "3L"), 4,
                   ifelse(pbp$pass_depth >= 0 & pbp$pass_depth < 5 & pbp$pass_zone %in% c("4"), 5,
                    ifelse(pbp$pass_depth >= 0 & pbp$pass_depth < 5 & pbp$pass_zone %in% c("5R", "6R", "7R"), 6,
                     ifelse(pbp$pass_depth >= 5 & pbp$pass_depth < 15 & pbp$pass_zone %in% c("1L", "2L", "3L"), 7,
                      ifelse(pbp$pass_depth >= 5 & pbp$pass_depth < 15 & pbp$pass_zone %in% c("4"), 8,
                       ifelse(pbp$pass_depth >= 5 & pbp$pass_depth < 15 & pbp$pass_zone %in% c("5R", "6R", "7R"), 9,
                        ifelse(pbp$pass_depth >= 15 & pbp$pass_depth < 25 & pbp$pass_zone %in% c("1L", "2L", "3L"), 10,
                         ifelse(pbp$pass_depth >= 15 & pbp$pass_depth < 25 & pbp$pass_zone %in% c("4"), 11,
                          ifelse(pbp$pass_depth >= 15 & pbp$pass_depth < 25 & pbp$pass_zone %in% c("5R", "6R", "7R"), 12,
                           ifelse(pbp$pass_depth >= 25 & pbp$pass_zone %in% c("1L", "2L", "3L"), 13,
                            ifelse(pbp$pass_depth >= 25 & pbp$pass_zone %in% c("4"), 14,
                             ifelse(pbp$pass_depth >= 25 & pbp$pass_zone %in% c("5R", "6R", "7R"), 15, NA)))))))))))))))
pbp$Drive.End.Next = c(pbp$drive_end_event[-c(1)],0)

pbp$Turnover = ifelse(pbp$drive_end_event == "FUMBLE" & pbp$DrivePlayNext == 1, 1,
                ifelse(pbp$drive_end_event == "INTERCEPTION" & pbp$DrivePlayNext == 1, 1,
                 ifelse(pbp$drive_end_event == "INTERCEPTION-TD" & pbp$Drive.End.Next != "INTERCEPTION-TD", 1,
                  ifelse(pbp$drive_end_event == "FUMBLE-TD" & pbp$Drive.End.Next != "FUMBLE-TD", 1, NA))))

pbp$Efficient = ifelse(!is.na(pbp$Turnover), 0,
                 ifelse(pbp$no_play == 1, NA,
                  ifelse(pbp$down==1, 
                   ifelse(pbp$Gain.Loss >= (pbp$distance*.4), 1, 0),
                    ifelse(pbp$down==2, 
                     ifelse(pbp$Gain.Loss >= (pbp$distance*.5), 1, 0),
                      ifelse(pbp$down==3, 
                       ifelse(pbp$Gain.Loss >= pbp$distance, 1, 0),
                        ifelse(pbp$down==4, 
                         ifelse(pbp$Gain.Loss >= pbp$distance, 1, 0), NA))))))
pbp$FieldBoundary = ifelse(pbp$hash == "L" & pbp$pass_zone %in% c("1L", "2L", "3L"),"B",
                     ifelse(pbp$hash == "L" & pbp$pass_zone %in% c("5R", "6R", "7R"),"F",
                      ifelse(pbp$hash == "R" & pbp$pass_zone %in% c("1L", "2L", "3L"),"F",
                       ifelse(pbp$hash == "R" & pbp$pass_zone %in% c("5R", "6R", "7R"),"B",
                        ifelse(pbp$pass_zone == "4", "M",NA)))))
pbp$PassDepthZones = ifelse(pbp$pass_depth <= 0, 1,
                      ifelse(pbp$pass_depth > 0 & pbp$pass_depth <= 5, 2,
                       ifelse(pbp$pass_depth > 5 & pbp$pass_depth <= 10, 3,
                        ifelse(pbp$pass_depth > 10 & pbp$pass_depth <= 15, 4,
                         ifelse(pbp$pass_depth > 15 & pbp$pass_depth <= 20, 5,
                          ifelse(pbp$pass_depth > 20 & pbp$pass_depth <= 25, 6,
                           ifelse(pbp$pass_depth > 25 & pbp$pass_depth <= 30, 7,
                            ifelse(pbp$pass_depth > 30 & pbp$pass_depth <= 35, 8,
                             ifelse(pbp$pass_depth > 35 & pbp$pass_depth <= 40, 9,
                              ifelse(pbp$pass_depth > 40 & pbp$pass_depth <= 45, 10,
                               ifelse(pbp$pass_depth > 45 & pbp$pass_depth <= 50, 11, 
                                ifelse(pbp$pass_depth > 50, 12, NA))))))))))))

pbp$PassWidthZones = ifelse(pbp$pass_width < 8, 1,
                      ifelse(pbp$pass_width > 7 & pbp$pass_width < 15, 2,
                       ifelse(pbp$pass_width > 14 & pbp$pass_width < 22, 3,
                        ifelse(pbp$pass_width > 21 & pbp$pass_width < 32, 4,
                         ifelse(pbp$pass_width > 31 & pbp$pass_width < 39, 5,
                          ifelse(pbp$pass_width > 38 & pbp$pass_width < 46, 6, 7))))))

pbp$PassZones = pbp$PassWidthZones + ((pbp$PassDepthZones-1)*7)

pbp$PositionTarget = ifelse(pbp$pass_receiver_target_position %in% c("TE-iL", "TE-iR", "TE-L", "TE-R", "TE-oL", "TE-oR"), "TE",
                      ifelse(pbp$pass_receiver_target_position %in% c("RWR", "LWR"), "WR",
                       ifelse(pbp$pass_receiver_target_position %in% c("HB", "HB-L", "HB-R", "FB", "FB-L", "FB-R"), "RB",
                        ifelse(pbp$pass_receiver_target_position %in% c("SLoWR", "SLWR", "SRiWR", "SRWR", "SLiWR", "SRoWR"), "Slot", NA))))

pbp$DownType = ifelse(pbp$down == 1, "SD",
                ifelse(pbp$down == 2 & pbp$distance < 8, "SD",
                 ifelse(pbp$down == 3 & pbp$distance < 5, "SD",
                  ifelse(pbp$down == 4 & pbp$distance < 5, "SD", "PD" ))))
pbp$pass_blocking_number <- substr(pbp$pass_blocking_players, 1, 1)
pbp$play_end_field_position_number <- as.numeric(substr(pbp$play_end_field_position, 2, 3))

pbp$DrivePoints = ifelse(pbp$drive_end_event == "TOUCHDOWN", 7,
                   ifelse(pbp$drive_end_event == "FIELD GOAL", 3,
                    ifelse(pbp$drive_end_event == "INTERCEPTION-TD", -7,
                     ifelse(pbp$drive_end_event == "FUMBLE-TD", -7, 
                      ifelse(pbp$drive_end_event == "SAFETY", -2, 0)))))
pbp$DriveSuccess = ifelse(pbp$drive_end_event == "TOUCHDOWN" | pbp$drive_end_event == "FIELD GOAL" | pbp$drive_end_event == "MISSED FG", 1,0)

pbp$DriveReturnStart = lag(pbp$return_yards)
pbp$SpecialTeamsDriveStart = lag(pbp$special_teams_type)
pbp$PreviousGainLoss = lag(pbp$gain_loss_net)
pbp$box_players_number <- substr(pbp$box_players, 1, 1)

All_Team_Names <- read.csv("New Team Names.csv")
names(All_Team_Names)[names(All_Team_Names)=="Ã¯..TeamCode"] <- "TeamCode"
NCAA_Team_Names <- All_Team_Names %>% filter(NFL != 1) %>% select(TeamCode, Team.Name, Conf, PrimaryColor, SecondaryColor, Logo)
Teams <- All_Team_Names %>% filter(FBS == 1) %>% select(TeamCode, Team.Name, Conf, PrimaryColor, SecondaryColor, Logo)
FBSSchools <- Teams$TeamCode

dat <- Teams %>% separate(Logo, c("a", "b", "c", "d", "e", "f", "g", "h", "i", "j"), sep = "/") 

dat1 <- dat %>% mutate(j = str_replace_all(dat$j, "[^[:alnum:]]", "")) %>% separate(j, c("teamcode", "junk"), sep = "p") %>% select(-c("a", "b", "c", "d", "e", "f", "g", "h", "i", "junk")) %>% rename(TeamName = Team.Name)

pbp <- merge(pbp, NCAA_Team_Names, by.x = "offense", by.y = "TeamCode", sort = FALSE)
pbp <- merge(pbp, NCAA_Team_Names, by.x = "defense", by.y = "TeamCode", sort = FALSE)
colnames(pbp)[colnames(pbp) == "Team.Name.x"] = "OffTeamName"
colnames(pbp)[colnames(pbp) == "Team.Name.y"] = "DefTeamName"
colnames(pbp)[colnames(pbp) == "Logo.x"] = "OffTeamLogo"
colnames(pbp)[colnames(pbp) == "Logo.y"] = "DefTeamLogo"
colnames(pbp)[colnames(pbp) == "Conf.x"] = "OffTeamConference"
colnames(pbp)[colnames(pbp) == "Conf.y"] = "DefTeamConference"
colnames(pbp)[colnames(pbp) == "PrimaryColor.x"] = "OffPrimaryColor"
colnames(pbp)[colnames(pbp) == "PrimaryColor.y"] = "DefPrimaryColor"
colnames(pbp)[colnames(pbp) == "SecondaryColor.x"] = "OffSecondaryColor"
colnames(pbp)[colnames(pbp) == "SecondaryColor.y"] = "DefSecondaryColor"
pbp <- pbp %>% mutate(OffTeamName = as.character(OffTeamName), DefTeamName = as.character(DefTeamName), OffTeamLogo = as.character(OffTeamLogo),
                      DefTeamLogo = as.character(DefTeamLogo), OffTeamConference = as.character(OffTeamConference), DefTeamConference = as.character(DefTeamConference),
                      OffPrimaryColor = as.character(OffPrimaryColor), DefPrimaryColor = as.character(DefPrimaryColor), OffSecondaryColor = as.character(OffSecondaryColor),
                      DefSecondaryColor = as.character(DefSecondaryColor))

NoKicks = subset(pbp, !is.na(pbp$drive))
FBSvsFBS = subset(NoKicks, offense %in% FBSSchools & defense %in% FBSSchools)
FBSvsFBSNoGarbage = subset(FBSvsFBS, garbage_time == 0)
FBSOff = subset(NoKicks, offense %in% FBSSchools)
FBSDef = subset(NoKicks, defense %in% FBSSchools)
TotalPlaysOff = FBSOff %>% group_by(OffTeamName) %>% summarize(TotalPlaysOff = n()) %>% rename(TeamName = OffTeamName)
TotalPlaysDef = FBSDef %>% group_by(DefTeamName) %>% summarize(TotalPlaysDef = n()) %>% rename(TeamName = DefTeamName)


MostOffDriveThings <- FBSOff %>% group_by(uniqueID) %>% summarize(Plays = n(), Yards = sum(Gain.Loss, na.rm = TRUE), YPP = mean(Gain.Loss, na.rm = TRUE), AvgEPA = mean(expected_points_added, na.rm = TRUE), Efficiency = mean(Efficient, na.rm = TRUE), FirstDowns = sum(first_down_gained, na.rm = TRUE), LargeGain = max(Gain.Loss, na.rm = TRUE), Sacks = sum(!is.na(sack)), TFL = sum(TFL, na.rm = TRUE), ForcedFumbles = sum(!is.na(forced_fumble)), Interception = sum(!is.na(interception)), BP = sum(incompletion_type == "BP", na.rm = TRUE), PD = sum(incompletion_type == "PD", na.rm = TRUE), FarthestFPos = min(NewFPos, na.rm = TRUE)) %>% mutate(TotalTFL = Sacks + TFL, Havoc = TotalTFL + ForcedFumbles + PD + BP, RedZoneOpportunity = ifelse(FarthestFPos <=20, 1, 0)) %>% select(-BP,PD,FarthestFPos)

OffDriveBigPlays <- FBSOff %>% group_by(uniqueID) %>% filter(Gain.Loss >= 15) %>% summarize(BigPlays = n())
FirstDownEfficiency <- FBSOff %>% group_by(uniqueID) %>% filter(down == 1) %>% summarize(FirstDownEfficiency = mean(Efficient, na.rm = TRUE))
SecondDownEfficiency <- FBSOff %>% group_by(uniqueID) %>% filter(down == 2) %>% summarize(SecondDownEfficiency = mean(Efficient, na.rm = TRUE))
ThirdDownEfficiency <- FBSOff %>% group_by(uniqueID) %>% filter(down == 3) %>% summarize(ThirdDownEfficiency = mean(Efficient, na.rm = TRUE))
ScoringOpportunity <- FBSOff %>% group_by(uniqueID) %>% filter(down == 1) %>% summarize(FarthestFPos = min(NewFPos, na.rm = TRUE)) %>% mutate(ScoringOpportunity = ifelse(FarthestFPos <=40, 1, 0)) %>% select(-FarthestFPos)



RestofOffDriveThings <- FBSOff %>% group_by(uniqueID) %>% filter(drive_play == 1) %>% select(game_id, OffTeamName, DefTeamName, drive, NewFPos, drive_start_event, SpecialTeamsDriveStart, PreviousGainLoss, drive_end_event, score_differential, drive_end_field_position,
                                                                                             DrivePoints, two_minute, DriveSuccess, DriveReturnStart) %>% mutate(ScoringDrive = ifelse(DrivePoints > 0, 1, 0))

OffenseDriveDataFrame <- merge(MostOffDriveThings, RestofOffDriveThings, all=TRUE) %>% merge(OffDriveBigPlays, all = TRUE) %>% merge(FirstDownEfficiency, all = TRUE) %>% merge(SecondDownEfficiency, all = TRUE) %>%
  merge(ThirdDownEfficiency, all = TRUE) %>% merge(ScoringOpportunity, all = TRUE)

MostDefDriveThings <- FBSDef %>% group_by(uniqueOpponentID) %>% summarize(Plays = n(), Yards = sum(Gain.Loss, na.rm = TRUE), YPP = mean(Gain.Loss, na.rm = TRUE),
                                                                          AvgEPA = mean(expected_points_added, na.rm = TRUE), Efficiency = mean(Efficient, na.rm = TRUE), 
                                                                          FirstDowns = sum(first_down_gained, na.rm = TRUE), LargeGain = max(Gain.Loss, na.rm = TRUE),
                                                                          Sacks = sum(!is.na(sack)), TFL = sum(TFL, na.rm = TRUE), ForcedFumbles = sum(!is.na(forced_fumble)),
                                                                          Interception = sum(!is.na(interception)), BP = sum(incompletion_type == "BP", na.rm = TRUE), PD = sum(incompletion_type == "PD", na.rm = TRUE),
                                                                          FarthestFPos = min(NewFPos, na.rm = TRUE)) %>% 
  mutate(TotalTFL = Sacks + TFL, Havoc = TotalTFL + ForcedFumbles + PD + BP, RedZoneOpportunity = ifelse(FarthestFPos <=20, 1, 0)) %>% select(-BP,PD,FarthestFPos)

DefDriveBigPlays <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(Gain.Loss >= 15) %>% summarize(BigPlays = n())
FirstDownEfficiency <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(down == 1) %>% summarize(FirstDownEfficiency = mean(Efficient, na.rm = TRUE))
SecondDownEfficiency <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(down == 2) %>% summarize(SecondDownEfficiency = mean(Efficient, na.rm = TRUE))
ThirdDownEfficiency <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(down == 3) %>% summarize(ThirdDownEfficiency = mean(Efficient, na.rm = TRUE))
ScoringOpportunity <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(down == 1) %>% summarize(FarthestFPos = min(NewFPos, na.rm = TRUE)) %>% mutate(ScoringOpportunity = ifelse(FarthestFPos <=40, 1, 0)) %>% select(-FarthestFPos)

RestofDefDriveThings <- FBSDef %>% group_by(uniqueOpponentID) %>% filter(drive_play == 1) %>% select(game_id, OffTeamName, DefTeamName, drive, NewFPos, drive_start_event, drive_end_event, score_differential, drive_end_field_position,
                                                                                                     DrivePoints, two_minute, DriveSuccess, DriveReturnStart) %>% mutate(ScoringDrive = ifelse(DrivePoints > 0, 1, 0))

DefenseDriveDataFrame <- merge(MostDefDriveThings, RestofDefDriveThings, all=TRUE) %>% merge(DefDriveBigPlays, all = TRUE) %>% merge(FirstDownEfficiency, all = TRUE) %>% merge(SecondDownEfficiency, all = TRUE) %>%
  merge(ThirdDownEfficiency, all = TRUE) %>% merge(ScoringOpportunity, all = TRUE)

GamesPlayed <- FBSOff %>% group_by(OffTeamName) %>% summarize(GamesPlayed = n_distinct(game_id)) %>% rename(TeamName = OffTeamName)


```

## Special Teams
```{r all, echo= FALSE, warning=FALSE, message = FALSE}
PuntReturns <- pbp %>% group_by(DefTeamName) %>% filter(defense %in% FBSSchools) %>% filter(special_teams_type == "PUNT") %>% summarize(AvgPuntReturn = mean(return_yards, na.rm = TRUE)) %>% arrange(desc(AvgPuntReturn)) %>% mutate(PuntReturnsRank = rank(desc(AvgPuntReturn), ties.method="first")) %>% rename(TeamName = DefTeamName) 

KickOffASFPos <- pbp %>% group_by(DefTeamName) %>% filter(defense %in% FBSSchools) %>% filter(special_teams_type == "KICKOFF") %>% filter(kick_result != "RECOVERED BY KICKING TEAM") %>%
  filter(kick_result != "TOUCHBACK") %>% filter(kick_result != "FAIR CATCH") %>% mutate(StartingFPos = NewFPos - gain_loss_net) %>% summarize(KOAvgStartingFPos = mean(StartingFPos, na.rm = TRUE)) %>% mutate(KOAvgStartingFPosRank = rank(KOAvgStartingFPos, ties.method="first")) %>% rename(TeamName = DefTeamName)

Punts <- pbp %>% group_by(OffTeamName) %>% filter(offense %in% FBSSchools) %>% filter(special_teams_type == "PUNT") %>% filter(is.na(penalty)) %>% summarize(NetPunt = mean(gain_loss_net, na.rm = TRUE)) %>% arrange(desc(NetPunt)) %>% mutate(NetPuntRank = rank(desc(NetPunt), ties.method="first")) %>% rename(TeamName = OffTeamName)

KickOffReturnASFPos <- pbp %>% group_by(OffTeamName) %>% filter(offense %in% FBSSchools) %>% filter(special_teams_type == "KICKOFF") %>% filter(kick_result != "TOUCHBACK" & kick_result != "RECOVERED BY KICKING TEAM") %>% mutate(StartingFPos = NewFPos - gain_loss_net) %>% summarize(KORAvgStartingFPos = mean(StartingFPos, na.rm = TRUE)) %>% 
  mutate(KORAvgStartingFPosRank = rank(desc(KORAvgStartingFPos), ties.method = "first")) %>% rename(TeamName = OffTeamName)

OppNetPunts <- pbp %>% group_by(DefTeamName) %>% filter(defense %in% FBSSchools) %>% filter(special_teams_type == "PUNT") %>% filter(is.na(penalty)) %>% summarize(OppNetPunt = mean(gain_loss_net, na.rm = TRUE)) %>% arrange(OppNetPunt) %>% mutate(OppNetPuntRank = rank(OppNetPunt, ties.method="first")) %>% rename(TeamName = DefTeamName)


SpecialTeamsDf = merge(PuntReturns, KickOffASFPos, all = TRUE) %>%
  merge(Punts, all = TRUE) %>% merge(KickOffReturnASFPos, all = TRUE) %>% merge(OppNetPunts, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)



tbl <- reactable(SpecialTeamsDf,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     filterable = FALSE,
                                     name = "",
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   PuntReturnsRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1", align = "center"),
                   KOAvgStartingFPosRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1", align = "center"),
                   NetPuntRank= colDef(name = "Rk", width = 50, filterable = FALSE, class = "record1", align = "center"),
                   KORAvgStartingFPosRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1", align = "center"),
                   OppNetPuntRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1"),
                   AvgPuntReturn = colDef(
                     defaultSortOrder = "desc",
                     align = "center",
                     width = 75,
                     name = "Avg PR", 
                     format = colFormat(digits = 3), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(SpecialTeamsDf$AvgPuntReturn, na.rm = TRUE))/(max(SpecialTeamsDf$AvgPuntReturn, na.rm = TRUE) - min(SpecialTeamsDf$AvgPuntReturn, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   KOAvgStartingFPos = colDef(
                     defaultSortOrder = "asc",
                     width = 105,
                     align = "center",
                     name = "KO Avg Starting FPos", 
                     format = colFormat(digits = 3), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(SpecialTeamsDf$KOAvgStartingFPos, na.rm = TRUE))/(max(SpecialTeamsDf$KOAvgStartingFPos, na.rm = TRUE) - min(SpecialTeamsDf$KOAvgStartingFPos, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   NetPunt = colDef(
                     defaultSortOrder = "desc",
                     name = "Net Punt", 
                     align = "center",
                     width = 75,
                     format = colFormat(digits = 3), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(SpecialTeamsDf$NetPunt, na.rm = TRUE))/(max(SpecialTeamsDf$NetPunt, na.rm = TRUE) - min(SpecialTeamsDf$NetPunt, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   KORAvgStartingFPos = colDef(
                     defaultSortOrder = "desc",
                     width = 105,
                     align = "center",
                     name = "KOR Avg Starting FPos", 
                     format = colFormat(digits = 3), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(SpecialTeamsDf$KORAvgStartingFPos, na.rm = TRUE))/(max(SpecialTeamsDf$KORAvgStartingFPos, na.rm = TRUE) - min(SpecialTeamsDf$KORAvgStartingFPos, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   OppNetPunt = colDef(
                     name = "Opp Net Punt", 
                     width = 75,
                     align = "center",
                     format = colFormat(digits = 2), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(SpecialTeamsDf$OppNetPunt, na.rm = TRUE))/(max(SpecialTeamsDf$OppNetPunt, na.rm = TRUE) - min(SpecialTeamsDf$OppNetPunt, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
    tbl
)
```

## Offensive Drives
```{r, echo= FALSE, warning=FALSE, message = FALSE}
OffenseDrives <- OffenseDriveDataFrame %>% group_by(OffTeamName) %>% summarize(across(c("NewFPos", "Plays", "Yards", "YPP", "Efficiency", "FirstDowns", "Havoc", "RedZoneOpportunity", "DrivePoints", "BigPlays", "FirstDownEfficiency", "SecondDownEfficiency", "ThirdDownEfficiency"), ~mean(.x, na.rm = TRUE))) %>% rename(TeamName = OffTeamName) %>% mutate(StartingFPos = 100-NewFPos) %>% select(-NewFPos) %>% relocate(StartingFPos, .after = TeamName)

OffenseDrives <- OffenseDrives %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(OffenseDrives,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                      style = sticky_style, filterable = FALSE,
                      name = "",
                      headerStyle = sticky_style,
                      cell = function(value) {
                        div(
                          class = "team",
                          img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                        )
                      }
                    ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   
                  GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                  
                   StartingFPos = colDef(defaultSortOrder = "desc", name = "Starting FPos", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$StartingFPos, na.rm = TRUE))/(max(OffenseDrives$StartingFPos, na.rm = TRUE) - min(OffenseDrives$StartingFPos, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   Plays = colDef(defaultSortOrder = "desc", name = "Plays / Drive", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$Plays, na.rm = TRUE))/(max(OffenseDrives$Plays, na.rm = TRUE) - min(OffenseDrives$Plays, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   Yards = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Yds / Drive", format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$Yards, na.rm = TRUE))/(max(OffenseDrives$Yards, na.rm = TRUE) - min(OffenseDrives$Yards, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   YPP = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "YPP / Drive", format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$YPP, na.rm = TRUE))/(max(OffenseDrives$YPP, na.rm = TRUE) - min(OffenseDrives$YPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   Efficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$Efficiency, na.rm = TRUE))/(max(OffenseDrives$Efficiency, na.rm = TRUE) - min(OffenseDrives$Efficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   FirstDowns = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "First Downs", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$FirstDowns, na.rm = TRUE))/(max(OffenseDrives$FirstDowns, na.rm = TRUE) - min(OffenseDrives$FirstDowns, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   Havoc = colDef(width = 75, align = "center", name = "Havoc / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$Havoc, na.rm = TRUE))/(max(OffenseDrives$Havoc, na.rm = TRUE) - min(OffenseDrives$Havoc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   RedZoneOpportunity = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "RZ Drive %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$RedZoneOpportunity, na.rm = TRUE))/(max(OffenseDrives$RedZoneOpportunity, na.rm = TRUE) - min(OffenseDrives$RedZoneOpportunity, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   DrivePoints = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Pts / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$DrivePoints, na.rm = TRUE))/(max(OffenseDrives$DrivePoints, na.rm = TRUE) - min(OffenseDrives$DrivePoints, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   BigPlays = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Big Plays / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$BigPlays, na.rm = TRUE))/(max(OffenseDrives$BigPlays, na.rm = TRUE) - min(OffenseDrives$BigPlays, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   FirstDownEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "1st Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$FirstDownEfficiency, na.rm = TRUE))/(max(OffenseDrives$FirstDownEfficiency, na.rm = TRUE) - min(OffenseDrives$FirstDownEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   SecondDownEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "2nd Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$SecondDownEfficiency, na.rm = TRUE))/(max(OffenseDrives$SecondDownEfficiency, na.rm = TRUE) - min(OffenseDrives$SecondDownEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   ThirdDownEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "3rd Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(OffenseDrives$ThirdDownEfficiency, na.rm = TRUE))/(max(OffenseDrives$ThirdDownEfficiency, na.rm = TRUE) - min(OffenseDrives$ThirdDownEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)})),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## Defensive Drives
```{r, echo= FALSE, warning=FALSE, message = FALSE}
DefenseDrives <- DefenseDriveDataFrame %>% group_by(DefTeamName) %>% summarize(across(c("NewFPos", "Plays", "Yards", "YPP", "Efficiency", "FirstDowns", "Havoc", "RedZoneOpportunity", "DrivePoints", "BigPlays", "FirstDownEfficiency", "SecondDownEfficiency", "ThirdDownEfficiency"), ~mean(.x, na.rm = TRUE))) %>% rename(TeamName = DefTeamName) %>% mutate(StartingFPos = 100-NewFPos) %>% select(-NewFPos) %>% relocate(StartingFPos, .after = TeamName)

DefenseDrives <- DefenseDrives %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName)  %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(DefenseDrives,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                      style = sticky_style, filterable = FALSE,
                      name = "",
                      headerStyle = sticky_style,
                      cell = function(value) {
                        div(
                          class = "team",
                          img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                        )
                      }
                    ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                  GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   StartingFPos = colDef(name = "Starting FPos", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$StartingFPos, na.rm = TRUE))/(max(DefenseDrives$StartingFPos, na.rm = TRUE) - min(DefenseDrives$StartingFPos, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   Plays = colDef(name = "Plays / Drive", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$Plays, na.rm = TRUE))/(max(DefenseDrives$Plays, na.rm = TRUE) - min(DefenseDrives$Plays, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   Yards = colDef(width = 75, align = "center", name = "Yds / Drive", format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$Yards, na.rm = TRUE))/(max(DefenseDrives$Yards, na.rm = TRUE) - min(DefenseDrives$Yards, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   YPP = colDef(width = 75, align = "center", name = "YPP / Drive", format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$YPP, na.rm = TRUE))/(max(DefenseDrives$YPP, na.rm = TRUE) - min(DefenseDrives$YPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   Efficiency = colDef(width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$Efficiency, na.rm = TRUE)) / (max(DefenseDrives$Efficiency, na.rm = TRUE) - min(DefenseDrives$Efficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   FirstDowns = colDef(width = 75, align = "center", name = "First Downs", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$FirstDowns, na.rm = TRUE)) / (max(DefenseDrives$FirstDowns, na.rm = TRUE) - min(DefenseDrives$FirstDowns, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   Havoc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Havoc / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$Havoc, na.rm = TRUE)) / (max(DefenseDrives$Havoc, na.rm = TRUE) - min(DefenseDrives$Havoc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RedZoneOpportunity = colDef(width = 75, align = "center", name = "RZ Drive %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$RedZoneOpportunity, na.rm = TRUE)) / (max(DefenseDrives$RedZoneOpportunity, na.rm = TRUE) - min(DefenseDrives$RedZoneOpportunity, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   DrivePoints = colDef(width = 75, align = "center", name = "Pts / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$DrivePoints, na.rm = TRUE)) / (max(DefenseDrives$DrivePoints, na.rm = TRUE) - min(DefenseDrives$DrivePoints, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   BigPlays = colDef(width = 75, align = "center", name = "Big Plays / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$BigPlays, na.rm = TRUE)) / (max(DefenseDrives$BigPlays, na.rm = TRUE) - min(DefenseDrives$BigPlays, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   FirstDownEfficiency = colDef(width = 75, align = "center", name = "1st Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$FirstDownEfficiency, na.rm = TRUE)) / (max(DefenseDrives$FirstDownEfficiency, na.rm = TRUE) - min(DefenseDrives$FirstDownEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   SecondDownEfficiency = colDef(width = 75, align = "center", name = "2nd Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$SecondDownEfficiency, na.rm = TRUE)) / (max(DefenseDrives$SecondDownEfficiency, na.rm = TRUE) - min(DefenseDrives$SecondDownEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   ThirdDownEfficiency = colDef(width = 75, align = "center", name = "3rd Down Eff", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(DefenseDrives$ThirdDownEfficiency, na.rm = TRUE)) / (max(DefenseDrives$ThirdDownEfficiency, na.rm = TRUE) - min(DefenseDrives$ThirdDownEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                  
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## RedZone
```{r, echo= FALSE, warning=FALSE, message = FALSE}
RedZoneOff <- FBSOff %>% group_by(OffTeamName) %>% filter(FieldZone == "RZ") %>% summarize(RedZoneOffPlays = n(), RedZoneOffEfficiency = sum(Efficient, na.rm = TRUE), RedZoneOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), RedZoneOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
RedZoneDef <- FBSDef %>% group_by(DefTeamName) %>% filter(FieldZone == "RZ") %>% summarize(RedZoneDefPlays = n(), RedZoneDefEfficiency = sum(Efficient, na.rm = TRUE), RedZoneDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), RedZoneDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

RedZoneOffDrives <- OffenseDriveDataFrame %>% group_by(OffTeamName) %>% filter(RedZoneOpportunity == 1) %>% summarize(OffRZTotalDrives = n(), OffPtsPerDrive = mean(DrivePoints, na.rm = TRUE), OffTD = sum(drive_end_event == "TOUCHDOWN", na.rm = TRUE), OffNoTD = sum(drive_end_event != "TOUCHDOWN", na.rm = TRUE), RZOffTDPerc = OffTD / OffRZTotalDrives) %>% select(-OffTD, -OffNoTD) %>% rename(TeamName = OffTeamName)
RedZoneDefDrives <- DefenseDriveDataFrame %>% group_by(DefTeamName) %>% filter(RedZoneOpportunity == 1) %>% summarize(DefRZTotalDrives = n(), DefPtsPerDrive = mean(DrivePoints, na.rm = TRUE), DefTD = sum(drive_end_event == "TOUCHDOWN", na.rm = TRUE), DefNoTD = sum(drive_end_event != "TOUCHDOWN", na.rm = TRUE), RZDefTDPerc = DefTD / DefRZTotalDrives) %>% select(-DefTD, -DefNoTD) %>% rename(TeamName = DefTeamName)

RedZoneCombined <- merge(RedZoneOff, RedZoneOffDrives, all = TRUE) %>% merge(RedZoneDef, all = TRUE) %>% merge(RedZoneDefDrives, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(RedZoneCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   
                   RedZoneOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Plays"),
                   
                   OffPtsPerDrive = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = " Off Pts / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$OffPtsPerDrive, na.rm = TRUE))/(max(RedZoneCombined$OffPtsPerDrive, na.rm = TRUE) - min(RedZoneCombined$OffPtsPerDrive, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   OffRZTotalDrives = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Drives"),
                   
                   RZOffTDPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off TD %", format = colFormat(percent = TRUE, digits = 1), 
                    footer = function(values, digits = 1) {
                    htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                      },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RZOffTDPerc, na.rm = TRUE))/(max(RedZoneCombined$RZOffTDPerc, na.rm = TRUE) - min(RedZoneCombined$RZOffTDPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RedZoneOffEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Eff Plays"),
                   
                   RedZoneOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                     htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                       },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RedZoneOffYPP, na.rm = TRUE))/(max(RedZoneCombined$RedZoneOffYPP, na.rm = TRUE) - min(RedZoneCombined$RedZoneOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RedZoneOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RedZoneOffEfficiencyPerc, na.rm = TRUE))/(max(RedZoneCombined$RedZoneOffEfficiencyPerc, na.rm = TRUE) - min(RedZoneCombined$RedZoneOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RedZoneDefPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   RedZoneDefEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   RedZoneDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RedZoneDefYPP, na.rm = TRUE)) / (max(RedZoneCombined$RedZoneDefYPP, na.rm = TRUE) - min(RedZoneCombined$RedZoneDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   RedZoneDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RedZoneDefEfficiencyPerc, na.rm = TRUE)) / (max(RedZoneCombined$RedZoneDefEfficiencyPerc, na.rm = TRUE) - min(RedZoneCombined$RedZoneDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   DefPtsPerDrive = colDef(width = 75, align = "center", name = " Off Pts / Drive", format = colFormat(digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$DefPtsPerDrive, na.rm = TRUE)) / (max(RedZoneCombined$DefPtsPerDrive, na.rm = TRUE) - min(RedZoneCombined$DefPtsPerDrive, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   DefRZTotalDrives = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Def Drives"),
                   
                   RZDefTDPerc = colDef(width = 75, align = "center", name = "Def TD %", format = colFormat(percent = TRUE, digits = 1), 
                      footer = function(values, digits = 1) {
                        htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                         },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(RedZoneCombined$RZDefTDPerc, na.rm = TRUE)) / (max(RedZoneCombined$RZDefTDPerc, na.rm = TRUE) - min(RedZoneCombined$RZDefTDPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("RedZoneOffPlays", "RedZoneOffEfficiency", "RedZoneOffEfficiencyPerc", "RedZoneOffYPP", "OffRZTotalDrives", "OffPtsPerDrive", "RZOffTDPerc")),
                   colGroup(name = "Defense", columns = c("RedZoneDefPlays", "RedZoneDefEfficiency", "RedZoneDefEfficiencyPerc", "RedZoneDefYPP", "DefRZTotalDrives", "DefPtsPerDrive", "RZDefTDPerc"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## 3rd Down Offense
```{r, echo= FALSE, warning=FALSE, message = FALSE}
ThirdShort <- FBSOff %>% group_by(OffTeamName) %>% filter(down == 3 & distance <= 2) %>% summarize(ThirdShortPlays = n(), ThirdShortEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdShortYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdShortPerc = ThirdShortEfficient/ThirdShortPlays, ThirdShortRank = rank(desc(ThirdShortPerc), ties.method="first")) %>% rename(TeamName = OffTeamName) %>% select(-ThirdShortEfficient)
ThirdMed <- FBSOff %>% group_by(OffTeamName) %>% filter(down == 3) %>% filter(distance < 7 & distance > 2) %>% summarize(ThirdMedPlays = n(), ThirdMedEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdMedYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdMedPerc = ThirdMedEfficient/ThirdMedPlays, ThirdMedRank = rank(desc(ThirdMedPerc), ties.method="first")) %>% rename(TeamName = OffTeamName) %>% select(-ThirdMedEfficient)
ThirdLong <- FBSOff %>% group_by(OffTeamName) %>% filter(down == 3 & distance >=7) %>% summarize(ThirdLongPlays = n(), ThirdLongEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdLongYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdLongPerc = ThirdLongEfficient/ThirdLongPlays, ThirdLongRank = rank(desc(ThirdLongPerc), ties.method="first")) %>% rename(TeamName = OffTeamName) %>% select(-ThirdLongEfficient)
OverallThirdDown <- FBSOff %>% group_by(OffTeamName) %>% filter(down == 3) %>% summarize(ThirdDownPlays = n(), ThirdDownEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdDownYPP = mean(Gain.Loss, na.rm = TRUE), AvgDist = mean(distance, na.rm = TRUE)) %>%
  mutate(ThirdDownPerc = ThirdDownEfficient/ThirdDownPlays, ThirdDownRank = rank(desc(ThirdDownPerc), ties.method="first")) %>% rename(TeamName = OffTeamName) %>% select(-ThirdDownEfficient)

ThirdDownCombined <- merge(ThirdShort, ThirdMed, all = TRUE) %>% merge(ThirdLong, all = TRUE) %>% merge(OverallThirdDown, all = TRUE) %>%
  merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(ThirdDownCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                      style = sticky_style, filterable = FALSE,
                      name = "",
                      headerStyle = sticky_style,
                      cell = function(value) {
                        div(
                          class = "team",
                          img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                        )
                      }
                    ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   ThirdShortRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdMedRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdLongRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdDownRank= colDef(name = "Rk", filterable = FALSE, width = 60, class = "record1", align = "center"),
                   
                   ThirdShortPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Short Plays"),
                   
                   ThirdShortYPP = colDef(defaultSortOrder = "desc", name = "Short YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else {normalized <- (value - min(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   ThirdShortPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Short %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                  
                   ThirdMedPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Med Plays"),
                   
                   ThirdMedYPP = colDef(defaultSortOrder = "desc", name = "Med YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   ThirdMedPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Med %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   ThirdLongPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Long Plays"),
                   
                   ThirdLongYPP = colDef(defaultSortOrder = "desc", name = "Long YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   ThirdLongPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Long %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   ThirdDownPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Plays"),
                   
                   ThirdDownYPP = colDef(defaultSortOrder = "desc", name = "Total YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   AvgDist= colDef(name = "Avg Distance", filterable = FALSE, format = colFormat(digits = 1), width = 75, align = "center"),
                   
                   ThirdDownPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Total %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)})),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## 3rd Down Defense
```{r, echo= FALSE, warning=FALSE, message = FALSE}
ThirdShort <- FBSDef %>% group_by(DefTeamName) %>% filter(down == 3 & distance <= 2) %>% summarize(ThirdShortPlays = n(), ThirdShortEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdShortYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdShortPerc = ThirdShortEfficient/ThirdShortPlays, ThirdShortRank = rank(ThirdShortPerc, ties.method="first")) %>% rename(TeamName = DefTeamName) %>% select(-ThirdShortEfficient)
ThirdMed <- FBSDef %>% group_by(DefTeamName) %>% filter(down == 3) %>% filter(distance < 7 & distance > 2) %>% summarize(ThirdMedPlays = n(), ThirdMedEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdMedYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdMedPerc = ThirdMedEfficient/ThirdMedPlays, ThirdMedRank = rank(ThirdMedPerc, ties.method="first")) %>% rename(TeamName = DefTeamName) %>% select(-ThirdMedEfficient)
ThirdLong <- FBSDef %>% group_by(DefTeamName) %>% filter(down == 3 & distance >=7) %>% summarize(ThirdLongPlays = n(), ThirdLongEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdLongYPP = mean(Gain.Loss, na.rm = TRUE)) %>%
  mutate(ThirdLongPerc = ThirdLongEfficient/ThirdLongPlays, ThirdLongRank = rank(ThirdLongPerc, ties.method="first")) %>% rename(TeamName = DefTeamName) %>% select(-ThirdLongEfficient)
OverallThirdDown <- FBSDef %>% group_by(DefTeamName) %>% filter(down == 3) %>% summarize(ThirdDownPlays = n(), ThirdDownEfficient = sum(Efficient == 1, na.rm = TRUE), ThirdDownYPP = mean(Gain.Loss, na.rm = TRUE), AvgDist = mean(distance, na.rm = TRUE)) %>%
  mutate(ThirdDownPerc = ThirdDownEfficient/ThirdDownPlays, ThirdDownRank = rank(ThirdDownPerc, ties.method="first")) %>% rename(TeamName = DefTeamName) %>% select(-ThirdDownEfficient)

ThirdDownCombined <- merge(ThirdShort, ThirdMed, all = TRUE) %>% merge(ThirdLong, all = TRUE) %>% merge(OverallThirdDown, all = TRUE) %>%
  merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(ThirdDownCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                      style = sticky_style, filterable = FALSE,
                      name = "",
                      headerStyle = sticky_style,
                      cell = function(value) {
                        div(
                          class = "team",
                          img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                        )
                      }
                    ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   ThirdShortRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdMedRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdLongRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   ThirdDownRank= colDef(name = "Rk", filterable = FALSE, width = 60, class = "record1", align = "center"),
                   
                   ThirdShortPlays = colDef(align = "center",width = 75,name = "Short Plays"),
                   
                   ThirdShortYPP = colDef(defaultSortOrder = "desc", name = "Short YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdShortYPP, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   ThirdShortPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Short %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdShortPerc, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                  
                   ThirdMedPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Med Plays"),
                   
                   ThirdMedYPP = colDef(defaultSortOrder = "desc", name = "Med YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdMedYPP, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   ThirdMedPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Med %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdMedPerc, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   ThirdLongPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Long Plays"),
                   
                   ThirdLongYPP = colDef(defaultSortOrder = "desc", name = "Long YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdLongYPP, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   ThirdLongPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Long %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdLongPerc, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   ThirdDownPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Plays"),
                   
                   ThirdDownYPP = colDef(defaultSortOrder = "desc", name = "Total YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE) - min(ThirdDownCombined$ThirdDownYPP, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   AvgDist= colDef(name = "Avg Distance", filterable = FALSE, format = colFormat(digits = 1), width = 75, align = "center"),
                   
                   ThirdDownPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Total %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE)) / (max(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE) - min(ThirdDownCombined$ThirdDownPerc, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)})),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)
```

## 2 Minute Off/Def
```{r, echo= FALSE, warning=FALSE, message = FALSE}
TwoMinuteEffOff = FBSOff %>% group_by(OffTeamName) %>% filter(two_minute == 2) %>% 
  summarize(TwoMinuteOffPlays = n(), TwoMinuteOffEffPlays = sum(Efficient == 1, na.rm = TRUE), TwoMinuteOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(TwoMinuteOffOffensiveEfficiency = TwoMinuteOffEffPlays/TwoMinuteOffPlays, TwoMinuteOffRank = rank(desc(TwoMinuteOffOffensiveEfficiency), ties.method="first")) %>%
  rename(TeamName = OffTeamName)
TwoMinuteDriveOff = OffenseDriveDataFrame %>% group_by(OffTeamName) %>% filter(two_minute == 2) %>% 
  summarize(TwoMinuteOffDrives = n(), OffScoringDrive = sum(ScoringDrive == 1, na.rm = TRUE), TwoMinuteOffYPDrive = mean(Yards, na.rm = TRUE)) %>% mutate(TwoMinuteDriveOffensiveScoringEfficiency = OffScoringDrive/TwoMinuteOffDrives, TwoMinuteOffDriveRank = rank(desc(TwoMinuteDriveOffensiveScoringEfficiency), ties.method="first")) %>%
  rename(TeamName = OffTeamName)
TwoMinuteEffDef = FBSDef %>% filter(two_minute == 2) %>% group_by(DefTeamName) %>% 
  summarize(TwoMinuteDefPlays = n(), TwoMinuteDefEffPlays = sum(Efficient == 1, na.rm = TRUE), TwoMinuteDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(TwoMinuteDefOffensiveEfficiency = TwoMinuteDefEffPlays/TwoMinuteDefPlays, TwoMinuteDefRank = rank(TwoMinuteDefOffensiveEfficiency, ties.method="first")) %>%
  rename(TeamName = DefTeamName)
TwoMinuteDriveDef = DefenseDriveDataFrame %>% group_by(DefTeamName) %>% filter(two_minute == 2) %>% 
  summarize(TwoMinuteDefDrives = n(), DefScoringDrive = sum(ScoringDrive == 1, na.rm = TRUE), TwoMinuteDefYPDrive = mean(Yards, na.rm = TRUE)) %>% mutate(TwoMinuteDriveDefensiveScoringEfficiency = DefScoringDrive/TwoMinuteDefDrives, TwoMinuteDefDriveRank = rank(TwoMinuteDriveDefensiveScoringEfficiency, ties.method="first")) %>%
  rename(TeamName = DefTeamName)

TwoMinuteCombined <- merge(TwoMinuteEffOff, TwoMinuteDriveOff, all = TRUE) %>% merge(TwoMinuteEffDef, all = TRUE) %>% merge(TwoMinuteDriveDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(TwoMinuteCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                      style = sticky_style, filterable = FALSE,
                      name = "",
                      headerStyle = sticky_style,
                      cell = function(value) {
                        div(
                          class = "team",
                          img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                        )
                      }
                    ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   TwoMinuteOffDriveRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   TwoMinuteOffRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   TwoMinuteDefRank= colDef(name = "Rk", width = 60, filterable = FALSE, class = "record1", align = "center"),
                   TwoMinuteDefDriveRank= colDef(name = "Rk", filterable = FALSE, width = 60, class = "record1", align = "center"),
                   
                   TwoMinuteOffDrives = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Drive #"),
                   
                   OffScoringDrive = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Score Drive #"),
                   
                   TwoMinuteOffYPDrive = colDef(defaultSortOrder = "desc", name = "Off Yds / Drive", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteOffYPDrive, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteOffYPDrive, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteOffYPDrive, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteDriveOffensiveScoringEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Drive Score %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteDriveOffensiveScoringEfficiency, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteDriveOffensiveScoringEfficiency, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteDriveOffensiveScoringEfficiency, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Play #"),
                   
                   TwoMinuteOffEffPlays = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Play Eff #"),
                   
                   TwoMinuteOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteOffYPP, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteOffYPP, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteOffYPP, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteOffOffensiveEfficiency, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteOffOffensiveEfficiency, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteOffOffensiveEfficiency, na.rm = TRUE))
                       color <- col_pal_good(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteDefDrives = colDef(align = "center",width = 75,name = "Def Drive #"),
                   
                   DefScoringDrive = colDef(width = 75, align = "center", name = "Def Score Drive #"),
                   
                   TwoMinuteDefYPDrive = colDef(name = "Def Yds / Drive", align = "center", width = 75, format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteDefYPDrive, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteDefYPDrive, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteDefYPDrive, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteDriveDefensiveScoringEfficiency = colDef(width = 75, align = "center", name = "Def Drive Score %",  format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteDriveDefensiveScoringEfficiency, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteDriveDefensiveScoringEfficiency, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteDriveDefensiveScoringEfficiency, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   TwoMinuteDefPlays = colDef(align = "center",width = 75,name = "Def Play #"),
                   
                   TwoMinuteDefEffPlays = colDef(width = 75, align = "center", name = "Def Play Eff #"),
                   
                   TwoMinuteDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteDefYPP, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteDefYPP, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteDefYPP, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)}),
                   
                   TwoMinuteDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(TwoMinuteCombined$TwoMinuteDefOffensiveEfficiency, na.rm = TRUE)) / (max(TwoMinuteCombined$TwoMinuteDefOffensiveEfficiency, na.rm = TRUE) - min(TwoMinuteCombined$TwoMinuteDefOffensiveEfficiency, na.rm = TRUE))
                       color <- col_pal_bad(normalized)}
                       list(background = color)})),
                 columnGroups = list(
            colGroup(name = "Offense", columns = c("TwoMinuteOffPlays", "TwoMinuteOffEffPlays", "TwoMinuteOffYPP", "TwoMinuteOffOffensiveEfficiency", "TwoMinuteOffDrives", "OffScoringDrive", "TwoMinuteOffRank", "TwoMinuteOffYPDrive", "TwoMinuteDriveOffensiveScoringEfficiency", "TwoMinuteOffDriveRank")),
            colGroup(name = "Defense", columns = c("TwoMinuteDefPlays", "TwoMinuteDefEffPlays", "TwoMinuteDefYPP", "TwoMinuteDefOffensiveEfficiency","TwoMinuteDefRank", "TwoMinuteDefDrives", "DefScoringDrive", "TwoMinuteDefYPDrive", "TwoMinuteDriveDefensiveScoringEfficiency", "TwoMinuteDefDriveRank"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## 4 Minute Off/Def
```{r, echo= FALSE, warning=FALSE, message = FALSE}
FourMinuteEffOff = FBSOff %>% filter(two_minute == 4) %>% group_by(OffTeamName) %>% 
  summarize(FourMinuteOffPlays = n(), FourMinuteOffEffPlays = sum(Efficient == 1, na.rm = TRUE), FourMinuteOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(FourMinuteOffOffensiveEfficiency = FourMinuteOffEffPlays/FourMinuteOffPlays, FourMinuteOffRank = rank(desc(FourMinuteOffOffensiveEfficiency), ties.method="first")) %>% rename(TeamName = OffTeamName)
FourMinuteEffDef = FBSDef %>% filter(two_minute == 4) %>% group_by(DefTeamName) %>% 
  summarize(FourMinuteDefPlays = n(), FourMinuteDefEffPlays = sum(Efficient == 1, na.rm = TRUE), FourMinuteDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(FourMinuteDefOffensiveEfficiency = FourMinuteDefEffPlays/FourMinuteDefPlays, FourMinuteDefRank = rank(FourMinuteDefOffensiveEfficiency, ties.method="first")) %>% rename(TeamName = DefTeamName)

FourMinuteCombined <- merge(FourMinuteEffOff, FourMinuteEffDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(FourMinuteCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style, filterable = FALSE,
                                     name = "",
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   FourMinuteOffRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1", align = "center"),
                   FourMinuteDefRank= colDef(name = "Rk", filterable = FALSE, width = 50, class = "record1", align = "center"),
                   
                   FourMinuteOffPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75,name = "Off Play #"),
                   
                   FourMinuteOffEffPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75,name = "Off Eff Plays"),
                   
                   FourMinuteOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(FourMinuteCombined$FourMinuteOffYPP, na.rm = TRUE))/(max(FourMinuteCombined$FourMinuteOffYPP, na.rm = TRUE) - min(FourMinuteCombined$FourMinuteOffYPP, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)}),
                   
                   FourMinuteOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                                             style = function(value) {
                                                               if (is.na(value)) {
                                                                 color <- "#A9A9A9"}
                                                               else {normalized <- (value - min(FourMinuteCombined$FourMinuteOffOffensiveEfficiency, na.rm = TRUE))/(max(FourMinuteCombined$FourMinuteOffOffensiveEfficiency, na.rm = TRUE) - min(FourMinuteCombined$FourMinuteOffOffensiveEfficiency, na.rm = TRUE))
                                                               color <- col_pal_bad(normalized)}
                                                               list(background = color)}),
                   
                   FourMinuteDefPlays = colDef(align = "center",width = 75,name = "Def Play #"),
                   
                   FourMinuteDefEffPlays = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   FourMinuteDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else {normalized <- (value - min(FourMinuteCombined$FourMinuteDefYPP, na.rm = TRUE))/(max(FourMinuteCombined$FourMinuteDefYPP, na.rm = TRUE) - min(FourMinuteCombined$FourMinuteDefYPP, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)}),
                   
                   FourMinuteDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                                             style = function(value) {
                                                               if (is.na(value)) {
                                                                 color <- "#A9A9A9"}
                                                               else {normalized <- (value - min(FourMinuteCombined$FourMinuteDefOffensiveEfficiency, na.rm = TRUE))/(max(FourMinuteCombined$FourMinuteDefOffensiveEfficiency, na.rm = TRUE) - min(FourMinuteCombined$FourMinuteDefOffensiveEfficiency, na.rm = TRUE))
                                                               color <- col_pal_bad(normalized)}
                                                               list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("FourMinuteOffPlays", "FourMinuteOffEffPlays", "FourMinuteOffYPP", "FourMinuteOffOffensiveEfficiency","FourMinuteOffRank")),
                   colGroup(name = "Defense", columns = c("FourMinuteDefPlays", "FourMinuteDefEffPlays", "FourMinuteDefYPP", "FourMinuteDefOffensiveEfficiency","FourMinuteDefRank"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## Off Pers R/P
```{r, echo= FALSE, warning=FALSE, message = FALSE}
FBSOffPers <- FBSOff %>% group_by(OffTeamName, offensive_personnel_basic) %>% summarize(Plays = n(), YPP = mean(Gain.Loss, na.rm = TRUE), EffPerc = mean(Efficient, na.rm = TRUE), RunPlays = sum(run_pass == "R", na.rm = TRUE), YdsPerRush = mean(Gain.Loss[run_pass == "R"], na.rm = TRUE), PassPlays = sum(run_pass == "P", na.rm = TRUE), YdsPerPass = mean(Gain.Loss[run_pass == "P"], na.rm = TRUE)) %>%
  mutate(RunPerc = RunPlays / Plays, PassPerc = PassPlays/Plays) %>% relocate(RunPerc, .after = YdsPerRush) %>% rename(TeamName = OffTeamName)


FBSOffPers <- merge(FBSOffPers, dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)



tbl <- reactable(FBSOffPers,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     filterable = FALSE,
                                     name = "",
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   
                   offensive_personnel_basic = colDef(name = "Offensive Personnel", style = sticky_style, headerStyle = sticky_style, width = 125, class = "team-name", align = "left"),
                  
                   Plays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Plays"),
                   RunPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Run Plays"),
                   PassPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Pass Plays"),
                   
                    YPP = colDef(defaultSortOrder = "desc", name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSOffPers$YPP, na.rm = TRUE))/(max(FBSOffPers$YPP, na.rm = TRUE) - min(FBSOffPers$YPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   YdsPerRush = colDef(defaultSortOrder = "desc", name = "Yds / Rush", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSOffPers$YdsPerRush, na.rm = TRUE))/(max(FBSOffPers$YdsPerRush, na.rm = TRUE) - min(FBSOffPers$YdsPerRush, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   YdsPerPass = colDef(defaultSortOrder = "desc", name = "Yds / Pass", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSOffPers$YdsPerPass, na.rm = TRUE))/(max(FBSOffPers$YdsPerPass, na.rm = TRUE) - min(FBSOffPers$YdsPerPass, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RunPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Run %", format = colFormat(percent = TRUE, digits = 1)), 
                    
                   PassPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Pass %", format = colFormat(percent = TRUE, digits = 1)),
                   
                   EffPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSOffPers$EffPerc, na.rm = TRUE))/(max(FBSOffPers$EffPerc, na.rm = TRUE) - min(FBSOffPers$EffPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)
```

## Def Pers R/P
```{r, echo= FALSE, warning=FALSE, message = FALSE}
FBSDefPers <- FBSDef %>% group_by(DefTeamName, offensive_personnel_basic) %>% summarize(Plays = n(), YPP = mean(Gain.Loss, na.rm = TRUE), EffPerc = mean(Efficient, na.rm = TRUE), RunPlays = sum(run_pass == "R", na.rm = TRUE), YdsPerRush = mean(Gain.Loss[run_pass == "R"], na.rm = TRUE), PassPlays = sum(run_pass == "P", na.rm = TRUE), YdsPerPass = mean(Gain.Loss[run_pass == "P"], na.rm = TRUE)) %>%
  mutate(RunPerc = RunPlays / Plays, PassPerc = PassPlays/Plays) %>% relocate(RunPerc, .after = YdsPerRush) %>% rename(TeamName = DefTeamName)


FBSDefPers <- merge(FBSDefPers, dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)



tbl <- reactable(FBSDefPers,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     filterable = FALSE,
                                     name = "",
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Def Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   
                   offensive_personnel_basic = colDef(name = "Offensive Personnel", style = sticky_style, headerStyle = sticky_style, width = 125, class = "team-name", align = "left"),
                  
                   Plays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Plays"),
                   RunPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Run Plays"),
                   PassPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Pass Plays"),
                   
                    YPP = colDef(defaultSortOrder = "desc", name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                     },
                     style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSDefPers$YPP, na.rm = TRUE))/(max(FBSDefPers$YPP, na.rm = TRUE) - min(FBSDefPers$YPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   YdsPerRush = colDef(defaultSortOrder = "desc", name = "Yds / Rush", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSDefPers$YdsPerRush, na.rm = TRUE))/(max(FBSDefPers$YdsPerRush, na.rm = TRUE) - min(FBSDefPers$YdsPerRush, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   YdsPerPass = colDef(defaultSortOrder = "desc", name = "Yds / Pass", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSDefPers$YdsPerPass, na.rm = TRUE))/(max(FBSDefPers$YdsPerPass, na.rm = TRUE) - min(FBSDefPers$YdsPerPass, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   RunPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Run %", format = colFormat(percent = TRUE, digits = 1)), 
                    
                   PassPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Pass %", format = colFormat(percent = TRUE, digits = 1)),
                   
                   EffPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                       if (is.na(value)) {
                         color <- "#A9A9A9"}
                       else { normalized <- (value - min(FBSDefPers$EffPerc, na.rm = TRUE))/(max(FBSDefPers$EffPerc, na.rm = TRUE) - min(FBSDefPers$EffPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)
```

## # of Pass Blockers
```{r, echo= FALSE, warning=FALSE, message = FALSE}
PassBlockersOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, pass_blocking_number) %>% summarize(OffPassBlockPlays = n(), OffPassBlockEfficiency = sum(Efficient, na.rm = TRUE), OffPassBlockEfficiencyPerc = mean(Efficient, na.rm = TRUE), OffPassBlockYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
PassBlockersDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, pass_blocking_number) %>% summarize(DefPassBlockPlays = n(), DefPassBlockEfficiency = sum(Efficient, na.rm = TRUE), DefPassBlockEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefPassBlockYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

PassBlockersCombined <- merge(PassBlockersOff, PassBlockersDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(PassBlockersCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   pass_blocking_number = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 75, name = "Pass Blocking #"),
                   
                   OffPassBlockPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Plays"),
                   OffPassBlockEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Eff Plays"),
                   
                   OffPassBlockYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(PassBlockersCombined$OffPassBlockYPP, na.rm = TRUE))/(max(PassBlockersCombined$OffPassBlockYPP, na.rm = TRUE) - min(PassBlockersCombined$OffPassBlockYPP, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   OffPassBlockEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                              style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(PassBlockersCombined$OffPassBlockEfficiencyPerc, na.rm = TRUE))/(max(PassBlockersCombined$OffPassBlockEfficiencyPerc, na.rm = TRUE) - min(PassBlockersCombined$OffPassBlockEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   DefPassBlockPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   DefPassBlockEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   DefPassBlockYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(PassBlockersCombined$DefPassBlockYPP, na.rm = TRUE)) / (max(PassBlockersCombined$DefPassBlockYPP, na.rm = TRUE) - min(PassBlockersCombined$DefPassBlockYPP, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)}),
                   
                   DefPassBlockEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(PassBlockersCombined$DefPassBlockEfficiencyPerc, na.rm = TRUE)) / (max(PassBlockersCombined$DefPassBlockEfficiencyPerc, na.rm = TRUE) - min(PassBlockersCombined$DefPassBlockEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("OffPassBlockPlays", "OffPassBlockEfficiency", "OffPassBlockEfficiencyPerc", "OffPassBlockYPP")),
                   colGroup(name = "Defense", columns = c("DefPassBlockPlays", "DefPassBlockEfficiency", "DefPassBlockEfficiencyPerc", "DefPassBlockYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## # of Box Players
```{r, echo= FALSE, warning=FALSE, message = FALSE}
BoxPlayersOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, box_players_number) %>% summarize(OffBoxPlayersPlays = n(), OffBoxPlayersEfficiency = sum(Efficient, na.rm = TRUE), OffBoxPlayersEfficiencyPerc = mean(Efficient, na.rm = TRUE), OffBoxPlayersYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
BoxPlayersDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, box_players_number) %>% summarize(DefBoxPlayersPlays = n(), DefBoxPlayersEfficiency = sum(Efficient, na.rm = TRUE), DefBoxPlayersEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefBoxPlayersYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

BoxPlayersCombined <- merge(BoxPlayersOff, BoxPlayersDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(BoxPlayersCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   box_players_number = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 75, name = "Box Players #"),
                   
                   OffBoxPlayersPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Plays"),
                   OffBoxPlayersEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Eff Plays"),
                   
                   OffBoxPlayersYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(BoxPlayersCombined$OffBoxPlayersYPP, na.rm = TRUE))/(max(BoxPlayersCombined$OffBoxPlayersYPP, na.rm = TRUE) - min(BoxPlayersCombined$OffBoxPlayersYPP, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   OffBoxPlayersEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                              style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(BoxPlayersCombined$OffBoxPlayersEfficiencyPerc, na.rm = TRUE))/(max(BoxPlayersCombined$OffBoxPlayersEfficiencyPerc, na.rm = TRUE) - min(BoxPlayersCombined$OffBoxPlayersEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   DefBoxPlayersPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   DefBoxPlayersEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   DefBoxPlayersYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(BoxPlayersCombined$DefBoxPlayersYPP, na.rm = TRUE)) / (max(BoxPlayersCombined$DefBoxPlayersYPP, na.rm = TRUE) - min(BoxPlayersCombined$DefBoxPlayersYPP, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)}),
                   
                   DefBoxPlayersEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(BoxPlayersCombined$DefBoxPlayersEfficiencyPerc, na.rm = TRUE)) / (max(BoxPlayersCombined$DefBoxPlayersEfficiencyPerc, na.rm = TRUE) - min(BoxPlayersCombined$DefBoxPlayersEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("OffBoxPlayersPlays", "OffBoxPlayersEfficiency", "OffBoxPlayersEfficiencyPerc", "OffBoxPlayersYPP")),
                   colGroup(name = "Defense", columns = c("DefBoxPlayersPlays", "DefBoxPlayersEfficiency", "DefBoxPlayersEfficiencyPerc", "DefBoxPlayersYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## Dropback Depth
```{r, echo= FALSE, warning=FALSE, message = FALSE}
DropBackDepthOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, dropback_depth) %>% summarize(OffDropBackPlays = n(), OffDropBackEfficiency = sum(Efficient, na.rm = TRUE), OffDropBackEfficiencyPerc = mean(Efficient, na.rm = TRUE), OffDropBackYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
DropBackDepthDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, dropback_depth) %>% summarize(DefDropBackPlays = n(), DefDropBackEfficiency = sum(Efficient, na.rm = TRUE), DefDropBackEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefDropBackYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

DropBackDepthCombined <- merge(DropBackDepthOff, DropBackDepthDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName)%>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(DropBackDepthCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   dropback_depth = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 75, name = "DB Depth"),
                   
                   OffDropBackPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Plays"),
                   OffDropBackEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Eff Plays"),
                   
                   OffDropBackYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(DropBackDepthCombined$OffDropBackYPP, na.rm = TRUE)) / (max(DropBackDepthCombined$OffDropBackYPP, na.rm = TRUE) - min(DropBackDepthCombined$OffDropBackYPP, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   OffDropBackEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                              style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(DropBackDepthCombined$OffDropBackEfficiencyPerc, na.rm = TRUE)) / (max(DropBackDepthCombined$OffDropBackEfficiencyPerc, na.rm = TRUE) - min(DropBackDepthCombined$OffDropBackEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   DefDropBackPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   DefDropBackEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   DefDropBackYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(DropBackDepthCombined$DefDropBackYPP, na.rm = TRUE)) / (max(DropBackDepthCombined$DefDropBackYPP, na.rm = TRUE) - min(DropBackDepthCombined$DefDropBackYPP, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)}),
                   
                   DefDropBackEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                                              style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(DropBackDepthCombined$DefDropBackEfficiencyPerc, na.rm = TRUE)) / (max(DropBackDepthCombined$DefDropBackEfficiencyPerc, na.rm = TRUE) - min(DropBackDepthCombined$DefDropBackEfficiencyPerc, na.rm = TRUE))
                                               color <- col_pal_bad(normalized)}
                                               list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("OffDropBackPlays", "OffDropBackEfficiency", "OffDropBackEfficiencyPerc", "OffDropBackYPP")),
                   colGroup(name = "Defense", columns = c("DefDropBackPlays", "DefDropBackEfficiency", "DefDropBackEfficiencyPerc", "DefDropBackYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## Shift/Motion Plays
```{r, echo= FALSE, warning=FALSE, message = FALSE}
ShiftMotionPlaysOff = FBSOff %>% filter(!is.na(shift_motion)) %>% group_by(OffTeamName) %>% 
  summarize(ShiftMotionPlaysOff = n(), ShiftMotionOffEffPlays = sum(Efficient == 1, na.rm = TRUE), ShiftMotionPlaysOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(ShiftMotionOffOffensiveEfficiency = ShiftMotionOffEffPlays/ShiftMotionPlaysOff, ShiftMotionOffRank = rank(desc(ShiftMotionOffOffensiveEfficiency), ties.method="first")) %>% rename(TeamName = OffTeamName)
ShiftMotionPlaysOff <- merge(ShiftMotionPlaysOff, TotalPlaysOff) %>% mutate(OffShiftMotionPerc = ShiftMotionPlaysOff / TotalPlaysOff)
ShiftMotionPlaysDef = FBSDef %>% filter(!is.na(shift_motion)) %>% group_by(DefTeamName) %>% 
  summarize(ShiftMotionPlaysDef = n(), ShiftMotionPlaysDefEffPlays = sum(Efficient == 1, na.rm = TRUE), ShiftMotionPlaysDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(ShiftMotionPlaysDefOffensiveEfficiency = ShiftMotionPlaysDefEffPlays/ShiftMotionPlaysDef, ShiftMotionDefRank = rank(ShiftMotionPlaysDefOffensiveEfficiency, ties.method="first")) %>% rename(TeamName = DefTeamName)
ShiftMotionPlaysDef <- merge(ShiftMotionPlaysDef, TotalPlaysDef) %>% mutate(DefShiftMotionPerc = ShiftMotionPlaysDef / TotalPlaysDef)

ShiftMotionPlaysCombined <- merge(ShiftMotionPlaysOff, ShiftMotionPlaysDef, all.x = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode) %>% relocate(TotalPlaysOff, .after = GamesPlayed) %>% relocate(TotalPlaysDef, .after = OffShiftMotionPerc)

tbl <- reactable(ShiftMotionPlaysCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   ShiftMotionOffRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   ShiftMotionDefRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   
                   ShiftMotionPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "M/S Play #"),
                   
                   ShiftMotionOffEffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "M/S Eff Plays"),
                   
                   ShiftMotionPlaysOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(ShiftMotionPlaysCombined$ShiftMotionPlaysOffYPP, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$ShiftMotionPlaysOffYPP, na.rm = TRUE) - min(ShiftMotionPlaysCombined$ShiftMotionPlaysOffYPP, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   ShiftMotionOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                    style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(ShiftMotionPlaysCombined$ShiftMotionOffOffensiveEfficiency, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$ShiftMotionOffOffensiveEfficiency, na.rm = TRUE) - min(ShiftMotionPlaysCombined$ShiftMotionOffOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   TotalPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Off Plays"),
                   
                   OffShiftMotionPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off M/S %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(ShiftMotionPlaysCombined$OffShiftMotionPerc, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$OffShiftMotionPerc, na.rm = TRUE) - min(ShiftMotionPlaysCombined$OffShiftMotionPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   ShiftMotionPlaysDef = colDef(align = "center",width = 75,name = "Def M/S #"),
                   
                   ShiftMotionPlaysDefEffPlays = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   ShiftMotionPlaysDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                    style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(ShiftMotionPlaysCombined$ShiftMotionPlaysDefYPP, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$ShiftMotionPlaysDefYPP, na.rm = TRUE) - min(ShiftMotionPlaysCombined$ShiftMotionPlaysDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   ShiftMotionPlaysDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                  style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(ShiftMotionPlaysCombined$ShiftMotionPlaysDefOffensiveEfficiency, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$ShiftMotionPlaysDefOffensiveEfficiency, na.rm = TRUE) - min(ShiftMotionPlaysCombined$ShiftMotionPlaysDefOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   TotalPlaysDef = colDef(align = "center",width = 75,name = "Total Def Plays"),
                   
                   DefShiftMotionPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Def M/S %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                   style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(ShiftMotionPlaysCombined$DefShiftMotionPerc, na.rm = TRUE)) / (max(ShiftMotionPlaysCombined$DefShiftMotionPerc, na.rm = TRUE) - min(ShiftMotionPlaysCombined$DefShiftMotionPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("ShiftMotionPlaysOff", "ShiftMotionOffEffPlays", "ShiftMotionPlaysOffYPP", "ShiftMotionOffOffensiveEfficiency","ShiftMotionOffRank", "TotalPlaysOff", "OffShiftMotionPerc")),
                   colGroup(name = "Defense", columns = c("ShiftMotionPlaysDef", "ShiftMotionPlaysDefEffPlays", "ShiftMotionPlaysDefYPP", "ShiftMotionPlaysDefOffensiveEfficiency","ShiftMotionDefRank", "TotalPlaysDef", "DefShiftMotionPerc"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## Blitz Plays
```{r, echo= FALSE, warning=FALSE, message = FALSE}
BlitzPlaysOff = FBSOff %>% filter(blitz_dog == 1) %>% group_by(OffTeamName) %>% 
  summarize(BlitzPlaysOff = n(), BlitzPlaysOffEffPlays = sum(Efficient == 1, na.rm = TRUE), BlitzPlaysOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(BlitzPlaysOffOffensiveEfficiency = BlitzPlaysOffEffPlays/BlitzPlaysOff, BlitzOffRank = rank(desc(BlitzPlaysOffOffensiveEfficiency), ties.method="first")) %>% rename(TeamName = OffTeamName)
BlitzPlaysOff <- merge(BlitzPlaysOff, TotalPlaysOff) %>% mutate(OffBlitzPerc = BlitzPlaysOff / TotalPlaysOff)
BlitzPlaysDef = FBSDef %>% filter(blitz_dog == 1) %>% group_by(DefTeamName) %>% 
  summarize(BlitzPlaysDef = n(), BlitzPlaysDefEffPlays = sum(Efficient == 1, na.rm = TRUE), BlitzPlaysDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(BlitzPlaysDefOffensiveEfficiency = BlitzPlaysDefEffPlays/BlitzPlaysDef, BlitzDefRank = rank(BlitzPlaysDefOffensiveEfficiency, ties.method="first")) %>% rename(TeamName = DefTeamName)
BlitzPlaysDef <- merge(BlitzPlaysDef, TotalPlaysDef) %>% mutate(DefBlitzPerc = BlitzPlaysDef / TotalPlaysDef)

BlitzPlaysCombined <- merge(BlitzPlaysOff, BlitzPlaysDef, all.x = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(BlitzPlaysCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   BlitzOffRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   BlitzDefRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   
                   BlitzPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Play #"),
                   
                   BlitzPlaysOffEffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Eff Plays"),
                   
                   BlitzPlaysOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                                             style = function(value) {
                                               if (is.na(value)) {
                                                 color <- "#A9A9A9"}
                                               else { normalized <- (value - min(BlitzPlaysCombined$BlitzPlaysOffYPP, na.rm = TRUE)) / (max(BlitzPlaysCombined$BlitzPlaysOffYPP, na.rm = TRUE) - min(BlitzPlaysCombined$BlitzPlaysOffYPP, na.rm = TRUE))
                                               color <- col_pal_good(normalized)}
                                               list(background = color)}),
                   
                   BlitzPlaysOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                    style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(BlitzPlaysCombined$BlitzPlaysOffOffensiveEfficiency, na.rm = TRUE)) / (max(BlitzPlaysCombined$BlitzPlaysOffOffensiveEfficiency, na.rm = TRUE) - min(BlitzPlaysCombined$BlitzPlaysOffOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   TotalPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Off Plays"),
                   
                   OffBlitzPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Blitz %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(BlitzPlaysCombined$OffBlitzPerc, na.rm = TRUE)) / (max(BlitzPlaysCombined$OffBlitzPerc, na.rm = TRUE) - min(BlitzPlaysCombined$OffBlitzPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   BlitzPlaysDef = colDef(align = "center",width = 75,name = "Def Play #"),
                   
                   BlitzPlaysDefEffPlays = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   BlitzPlaysDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                    style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(BlitzPlaysCombined$BlitzPlaysDefYPP, na.rm = TRUE)) / (max(BlitzPlaysCombined$BlitzPlaysDefYPP, na.rm = TRUE) - min(BlitzPlaysCombined$BlitzPlaysDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   BlitzPlaysDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                  style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(BlitzPlaysCombined$BlitzPlaysDefOffensiveEfficiency, na.rm = TRUE)) / (max(BlitzPlaysCombined$BlitzPlaysDefOffensiveEfficiency, na.rm = TRUE) - min(BlitzPlaysCombined$BlitzPlaysDefOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   TotalPlaysDef = colDef(align = "center",width = 75,name = "Total Def Plays"),
                   
                   DefBlitzPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Def Blitz %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                   style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(BlitzPlaysCombined$DefBlitzPerc, na.rm = TRUE)) / (max(BlitzPlaysCombined$DefBlitzPerc, na.rm = TRUE) - min(BlitzPlaysCombined$DefBlitzPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("BlitzPlaysOff", "BlitzPlaysOffEffPlays", "BlitzPlaysOffYPP", "BlitzPlaysOffOffensiveEfficiency","BlitzOffRank", "TotalPlaysOff", "OffBlitzPerc")),
                   colGroup(name = "Defense", columns = c("BlitzPlaysDef", "BlitzPlaysDefEffPlays", "BlitzPlaysDefYPP", "BlitzPlaysDefOffensiveEfficiency","BlitzDefRank", "TotalPlaysDef", "DefBlitzPerc"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## No Blitz Plays
```{r, echo= FALSE, warning=FALSE, message = FALSE}
NoBlitzPlaysOff = FBSOff %>% filter(blitz_dog == 0) %>% group_by(OffTeamName) %>% 
  summarize(NoBlitzPlaysOff = n(), NoBlitzPlaysOffEffPlays = sum(Efficient == 1, na.rm = TRUE), NoBlitzPlaysOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% 
  mutate(NoBlitzPlaysOffOffensiveEfficiency = NoBlitzPlaysOffEffPlays/NoBlitzPlaysOff, NoBlitzOffRank = rank(desc(NoBlitzPlaysOffOffensiveEfficiency), ties.method="first")) %>% rename(TeamName = OffTeamName)
NoBlitzPlaysDef = FBSDef %>% filter(blitz_dog == 0) %>% group_by(DefTeamName) %>% 
  summarize(NoBlitzPlaysDef = n(), NoBlitzPlaysDefEffPlays = sum(Efficient == 1, na.rm = TRUE), NoBlitzPlaysDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% 
  mutate(NoBlitzPlaysDefOffensiveEfficiency = NoBlitzPlaysDefEffPlays/NoBlitzPlaysDef, NoBlitzDefRank = rank(NoBlitzPlaysDefOffensiveEfficiency, ties.method="first")) %>% rename(TeamName = DefTeamName)

NoBlitzPlaysOff <- merge(NoBlitzPlaysOff, TotalPlaysOff) %>% mutate(OffNoBlitzPerc = NoBlitzPlaysOff / TotalPlaysOff)
NoBlitzPlaysDef <- merge(NoBlitzPlaysDef, TotalPlaysDef) %>% mutate(DefNoBlitzPerc = NoBlitzPlaysDef / TotalPlaysDef)

NoBlitzPlaysCombined <- merge(NoBlitzPlaysOff, NoBlitzPlaysDef, all.x = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode) 

tbl <- reactable(NoBlitzPlaysCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                style = sticky_style,
                                name = "", filterable = FALSE,
                                headerStyle = sticky_style,
                                cell = function(value) {
                                  div(
                                    class = "team",
                                    img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   NoBlitzOffRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   NoBlitzDefRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   
                   NoBlitzPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Play #"),
                   
                   NoBlitzPlaysOffEffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Eff Plays"),
                   
                   NoBlitzPlaysOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$NoBlitzPlaysOffYPP, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$NoBlitzPlaysOffYPP, na.rm = TRUE) - min(NoBlitzPlaysCombined$NoBlitzPlaysOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   NoBlitzPlaysOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$NoBlitzPlaysOffOffensiveEfficiency, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$NoBlitzPlaysOffOffensiveEfficiency, na.rm = TRUE) - min(NoBlitzPlaysCombined$NoBlitzPlaysOffOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   TotalPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Off Plays"),
                   
                   OffNoBlitzPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off No Blitz %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                         style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$OffNoBlitzPerc, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$OffNoBlitzPerc, na.rm = TRUE) - min(NoBlitzPlaysCombined$OffNoBlitzPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   NoBlitzPlaysDef = colDef(align = "center",width = 75,name = "Def Play #"),
                   
                   NoBlitzPlaysDefEffPlays = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   NoBlitzPlaysDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$NoBlitzPlaysDefYPP, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$NoBlitzPlaysDefYPP, na.rm = TRUE) - min(NoBlitzPlaysCombined$NoBlitzPlaysDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   NoBlitzPlaysDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$NoBlitzPlaysDefOffensiveEfficiency, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$NoBlitzPlaysDefOffensiveEfficiency, na.rm = TRUE) - min(NoBlitzPlaysCombined$NoBlitzPlaysDefOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                                  
                   TotalPlaysDef = colDef(align = "center",width = 75,name = "Total Def Plays"),
                   
                   DefNoBlitzPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Def No Blitz %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(NoBlitzPlaysCombined$DefNoBlitzPerc, na.rm = TRUE)) / (max(NoBlitzPlaysCombined$DefNoBlitzPerc, na.rm = TRUE) - min(NoBlitzPlaysCombined$DefNoBlitzPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("NoBlitzPlaysOff", "NoBlitzPlaysOffEffPlays", "NoBlitzPlaysOffYPP", "NoBlitzPlaysOffOffensiveEfficiency","NoBlitzOffRank", "TotalPlaysOff", "OffNoBlitzPerc")),
                   colGroup(name = "Defense", columns = c("NoBlitzPlaysDef", "NoBlitzPlaysDefEffPlays", "NoBlitzPlaysDefYPP", "NoBlitzPlaysDefOffensiveEfficiency","NoBlitzDefRank", "TotalPlaysDef", "DefNoBlitzPerc"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## Stunt
```{r, echo= FALSE, warning=FALSE, message = FALSE}
StuntOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, stunt) %>% summarize(StuntOffPlays = n(), StuntOffEfficiency = sum(Efficient, na.rm = TRUE), StuntOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), StuntOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
StuntDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, stunt) %>% summarize(StuntDefPlays = n(), StuntDefEfficiency = sum(Efficient, na.rm = TRUE), StuntDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), StuntDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

StuntCombined <- merge(StuntOff, StuntDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% mutate(stunt= ifelse(stunt == 1, "Yes", "No")) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)


tbl <- reactable(StuntCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   stunt = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 85, name = "Stunt"),
                   
                   StuntOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Plays"),
                   StuntOffEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Eff Plays"),
                   
                   StuntOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(StuntCombined$StuntOffYPP, na.rm = TRUE)) / (max(StuntCombined$StuntOffYPP, na.rm = TRUE) - min(StuntCombined$StuntOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   StuntOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(StuntCombined$StuntOffEfficiencyPerc, na.rm = TRUE)) / (max(StuntCombined$StuntOffEfficiencyPerc, na.rm = TRUE) - min(StuntCombined$StuntOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   StuntDefPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   StuntDefEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   StuntDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(StuntCombined$StuntDefYPP, na.rm = TRUE)) / (max(StuntCombined$StuntDefYPP, na.rm = TRUE) - min(StuntCombined$StuntDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   StuntDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(StuntCombined$StuntDefEfficiencyPerc, na.rm = TRUE)) / (max(StuntCombined$StuntDefEfficiencyPerc, na.rm = TRUE) - min(StuntCombined$StuntDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("StuntOffPlays", "StuntOffEfficiency", "StuntOffEfficiencyPerc", "StuntOffYPP")),
                   colGroup(name = "Defense", columns = c("StuntDefPlays", "StuntDefEfficiency", "StuntDefEfficiencyPerc", "StuntDefYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## MOFOC
```{r, echo= FALSE, warning=FALSE, message = FALSE}
MOFOCOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, mofoc_shown, mofoc_played) %>% summarize(MOFOCOffPlays = n(), MOFOCOffEfficiency = sum(Efficient, na.rm = TRUE), MOFOCOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), MOFOCOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
MOFOCDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, mofoc_shown, mofoc_played) %>% summarize(MOFOCDefPlays = n(), MOFOCDefEfficiency = sum(Efficient, na.rm = TRUE), MOFOCDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), MOFOCDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

MOFOCCombined <- merge(MOFOCOff, MOFOCDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(MOFOCCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   mofoc_shown = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 85, name = "MF Shown"),
                   
                   mofoc_played = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 85, name = "MF Played"),
                   
                   MOFOCOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Plays"),
                   MOFOCOffEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75, name = "Off Eff Plays"),
                   
                   MOFOCOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MOFOCCombined$MOFOCOffYPP, na.rm = TRUE)) / (max(MOFOCCombined$MOFOCOffYPP, na.rm = TRUE) - min(MOFOCCombined$MOFOCOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   MOFOCOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MOFOCCombined$MOFOCOffEfficiencyPerc, na.rm = TRUE)) / (max(MOFOCCombined$MOFOCOffEfficiencyPerc, na.rm = TRUE) - min(MOFOCCombined$MOFOCOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   MOFOCDefPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   MOFOCDefEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   MOFOCDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MOFOCCombined$MOFOCDefYPP, na.rm = TRUE)) / (max(MOFOCCombined$MOFOCDefYPP, na.rm = TRUE) - min(MOFOCCombined$MOFOCDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   MOFOCDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MOFOCCombined$MOFOCDefEfficiencyPerc, na.rm = TRUE)) / (max(MOFOCCombined$MOFOCDefEfficiencyPerc, na.rm = TRUE) - min(MOFOCCombined$MOFOCDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("MOFOCOffPlays", "MOFOCOffEfficiency", "MOFOCOffEfficiencyPerc", "MOFOCOffYPP")),
                   colGroup(name = "Defense", columns = c("MOFOCDefPlays", "MOFOCDefEfficiency", "MOFOCDefEfficiencyPerc", "MOFOCDefYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## QB Moved
```{r, echo= FALSE, warning=FALSE, message = FALSE}
QBMovedOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, quarterback_moved_off_spot) %>% summarize(QBMovedOffPlays = n(), QBMovedOffEfficiency = sum(Efficient, na.rm = TRUE), QBMovedOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), QBMovedOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
QBMovedDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, quarterback_moved_off_spot) %>% summarize(QBMovedDefPlays = n(), QBMovedDefEfficiency = sum(Efficient, na.rm = TRUE), QBMovedDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), QBMovedDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

QBMovedCombined <- merge(QBMovedOff, QBMovedDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% mutate(quarterback_moved_off_spot = ifelse(quarterback_moved_off_spot == 1, "Yes", "No")) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(QBMovedCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   quarterback_moved_off_spot = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 85, name = "QB Moved"),
                   
                   QBMovedOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Plays"),
                   QBMovedOffEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Eff Plays"),
                   
                   QBMovedOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBMovedCombined$QBMovedOffYPP, na.rm = TRUE)) / (max(QBMovedCombined$QBMovedOffYPP, na.rm = TRUE) - min(QBMovedCombined$QBMovedOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   QBMovedOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                         style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBMovedCombined$QBMovedOffEfficiencyPerc, na.rm = TRUE)) / (max(QBMovedCombined$QBMovedOffEfficiencyPerc, na.rm = TRUE) - min(QBMovedCombined$QBMovedOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   QBMovedDefPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   QBMovedDefEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   QBMovedDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                           style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBMovedCombined$QBMovedDefYPP, na.rm = TRUE)) / (max(QBMovedCombined$QBMovedDefYPP, na.rm = TRUE) - min(QBMovedCombined$QBMovedDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   QBMovedDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBMovedCombined$QBMovedDefEfficiencyPerc, na.rm = TRUE)) / (max(QBMovedCombined$QBMovedDefEfficiencyPerc, na.rm = TRUE) - min(QBMovedCombined$QBMovedDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("QBMovedOffPlays", "QBMovedOffEfficiency", "QBMovedOffEfficiencyPerc", "QBMovedOffYPP")),
                   colGroup(name = "Defense", columns = c("QBMovedDefPlays", "QBMovedDefEfficiency", "QBMovedDefEfficiencyPerc", "QBMovedDefYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## QB Scramble
```{r, echo= FALSE, warning=FALSE, message = FALSE}
QBScrambleOff <- FBSOff %>% filter(run_pass == "P") %>% group_by(OffTeamName, quarterback_scramble) %>% summarize(QBscrambleOffPlays = n(), QBscrambleOffEfficiency = sum(Efficient, na.rm = TRUE), QBscrambleOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), QBscrambleOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
QBScrambleDef <- FBSDef %>% filter(run_pass == "P") %>% group_by(DefTeamName, quarterback_scramble) %>% summarize(QBscrambleDefPlays = n(), QBscrambleDefEfficiency = sum(Efficient, na.rm = TRUE), QBscrambleDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), QBscrambleDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

QBScrambleCombined <- merge(QBScrambleOff, QBScrambleDef, all = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(QBScrambleCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                     style = sticky_style,
                                     name = "", filterable = FALSE,
                                     headerStyle = sticky_style,
                                     cell = function(value) {
                                       div(
                                         class = "team",
                                         img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   quarterback_scramble = colDef(defaultSortOrder = "desc", filterable = TRUE, align = "center",width = 85, name = "QB Scram"),
                   
                   QBscrambleOffPlays = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Plays"),
                   QBscrambleOffEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 85, name = "Off Eff Plays"),
                   
                   QBscrambleOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBScrambleCombined$QBscrambleOffYPP, na.rm = TRUE)) / (max(QBScrambleCombined$QBscrambleOffYPP, na.rm = TRUE) - min(QBScrambleCombined$QBscrambleOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   QBscrambleOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                        style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBScrambleCombined$QBscrambleOffEfficiencyPerc, na.rm = TRUE)) / (max(QBScrambleCombined$QBscrambleOffEfficiencyPerc, na.rm = TRUE) - min(QBScrambleCombined$QBscrambleOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   QBscrambleDefPlays = colDef(defaultSortOrder = "desc", align = "center", width = 75, name = "Def Plays"),
                   QBscrambleDefEfficiency = colDef(align = "center", width = 75, name = "Def Eff Plays"),
                   
                   QBscrambleDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                                             format = colFormat(digits = 1), 
                                             footer = function(values) {
                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                             },
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBScrambleCombined$QBscrambleDefYPP, na.rm = TRUE)) / (max(QBScrambleCombined$QBscrambleDefYPP, na.rm = TRUE) - min(QBScrambleCombined$QBscrambleDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   QBscrambleDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                                                             footer = function(values, digits = 1) {
                                                               htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                                                             },
                           style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QBScrambleCombined$QBscrambleDefEfficiencyPerc, na.rm = TRUE)) / (max(QBScrambleCombined$QBscrambleDefEfficiencyPerc, na.rm = TRUE) - min(QBScrambleCombined$QBscrambleDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("QBscrambleOffPlays", "QBscrambleOffEfficiency", "QBscrambleOffEfficiencyPerc", "QBscrambleOffYPP")),
                   colGroup(name = "Defense", columns = c("QBscrambleDefPlays", "QBscrambleDefEfficiency", "QBscrambleDefEfficiencyPerc", "QBscrambleDefYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## QB Hit or Hurry
```{r, echo= FALSE, warning=FALSE, message = FALSE}
HitHurryPlaysOff <- FBSOff %>% filter(!is.na(hit_players) | !is.na(hurry_players)) %>% group_by(OffTeamName) %>% 
  summarize(HitHurryPlaysOff = n(), HitHurryPlaysOffEffPlays = sum(Efficient == 1, na.rm = TRUE), HitHurryPlaysOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(HitHurryPlaysOffOffensiveEfficiency = HitHurryPlaysOffEffPlays/HitHurryPlaysOff, HitHurryPlaysOffRank = rank(desc(HitHurryPlaysOffOffensiveEfficiency), ties.method="first")) %>% rename(TeamName = OffTeamName)
HitHurryPlaysDef <- FBSDef %>% filter(!is.na(hit_players) | !is.na(hurry_players)) %>% group_by(DefTeamName) %>% 
  summarize(HitHurryPlaysDef = n(), HitHurryPlaysDefEffPlays = sum(Efficient == 1, na.rm = TRUE), HitHurryPlaysDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% mutate(HitHurryPlaysDefOffensiveEfficiency = HitHurryPlaysDefEffPlays/HitHurryPlaysDef, HitHurryPlaysDefRank = rank(HitHurryPlaysDefOffensiveEfficiency, ties.method="first")) %>% rename(TeamName = DefTeamName)

HitHurryCombined = merge(HitHurryPlaysOff, HitHurryPlaysDef, all.x = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(HitHurryCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                       style = sticky_style, filterable = FALSE,
                       name = "",
                       headerStyle = sticky_style,
                       cell = function(value) {
                         div(
                           class = "team",
                           img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value)))}),
                   
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   HitHurryPlaysOffRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   HitHurryPlaysDefRank= colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   
                   HitHurryPlaysOff = colDef(align = "center",width = 75,name = "Off Play #"),
                   
                   HitHurryPlaysOffEffPlays = colDef(align = "center",width = 75,name = "Off Eff Plays"),
                   
                   HitHurryPlaysOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(HitHurryCombined$HitHurryPlaysOffYPP, na.rm = TRUE)) / (max(HitHurryCombined$HitHurryPlaysOffYPP, na.rm = TRUE) - min(HitHurryCombined$HitHurryPlaysOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   HitHurryPlaysOffOffensiveEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(HitHurryCombined$HitHurryPlaysOffOffensiveEfficiency, na.rm = TRUE)) / (max(HitHurryCombined$HitHurryPlaysOffOffensiveEfficiency, na.rm = TRUE) - min(HitHurryCombined$HitHurryPlaysOffOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
            
                   HitHurryPlaysDef = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Def Play #"),
                   
                   HitHurryPlaysDefEffPlays = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   HitHurryPlaysDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(HitHurryCombined$HitHurryPlaysDefYPP, na.rm = TRUE)) / (max(HitHurryCombined$HitHurryPlaysDefYPP, na.rm = TRUE) - min(HitHurryCombined$HitHurryPlaysDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   HitHurryPlaysDefOffensiveEfficiency = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(HitHurryCombined$HitHurryPlaysDefOffensiveEfficiency, na.rm = TRUE)) / (max(HitHurryCombined$HitHurryPlaysDefOffensiveEfficiency, na.rm = TRUE) - min(HitHurryCombined$HitHurryPlaysDefOffensiveEfficiency, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("HitHurryPlaysOff", "HitHurryPlaysOffEffPlays", "HitHurryPlaysOffYPP", "HitHurryPlaysOffOffensiveEfficiency","HitHurryPlaysOffRank")),
                   colGroup(name = "Defense", columns = c("HitHurryPlaysDef", "HitHurryPlaysDefEffPlays", "HitHurryPlaysDefYPP", "HitHurryPlaysDefOffensiveEfficiency","HitHurryPlaysDefRank"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## Pass Direction
```{r, echo= FALSE, warning=FALSE, message = FALSE}
PassDirectionOff <- FBSOff %>% filter(run_pass == "P") %>% filter(pass_direction != "X") %>% group_by(OffTeamName, pass_direction) %>% summarize(PassDirectionOffPlays = n(), PassDirectionOffEfficiency = sum(Efficient, na.rm = TRUE), PassDirectionOffEfficiencyPerc = mean(Efficient, na.rm = TRUE), PassDirectionOffYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = OffTeamName)
PassDirectionDef <- FBSDef %>% filter(run_pass == "P") %>% filter(pass_direction != "X") %>% group_by(DefTeamName, pass_direction) %>% summarize(PassDirectionDefPlays = n(), PassDirectionDefEfficiency = sum(Efficient, na.rm = TRUE), PassDirectionDefEfficiencyPerc = mean(Efficient, na.rm = TRUE), PassDirectionDefYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(TeamName = DefTeamName)

PassDirectionCombined <- merge(PassDirectionOff, PassDirectionDef, by = c("TeamName", "pass_direction")) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode) 

tbl <- reactable(PassDirectionCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                       style = sticky_style, filterable = FALSE,
                       name = "",
                       headerStyle = sticky_style,
                       cell = function(value) {
                         div(
                           class = "team",
                           img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value)))}),
                   
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   pass_direction = colDef(name = "Pass Dir", filterable = TRUE, width = 100, class = "team-name", align = "center"),
                  
                   
                   PassDirectionOffPlays = colDef(align = "center", width = 75,name = "Off Play #"),
                   
                   PassDirectionOffEfficiency = colDef(align = "center", width = 75,name = "Off Eff Plays"),
                   
                   PassDirectionOffYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(PassDirectionCombined$PassDirectionOffYPP, na.rm = TRUE)) / (max(PassDirectionCombined$PassDirectionOffYPP, na.rm = TRUE) - min(PassDirectionCombined$PassDirectionOffYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   PassDirectionOffEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(PassDirectionCombined$PassDirectionOffEfficiencyPerc, na.rm = TRUE)) / (max(PassDirectionCombined$PassDirectionOffEfficiencyPerc, na.rm = TRUE) - min(PassDirectionCombined$PassDirectionOffEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
            
                   PassDirectionDefPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Def Play #"),
                   
                   PassDirectionDefEfficiency = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   PassDirectionDefYPP = colDef(name = "Def YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(PassDirectionCombined$PassDirectionDefYPP, na.rm = TRUE)) / (max(PassDirectionCombined$PassDirectionDefYPP, na.rm = TRUE) - min(PassDirectionCombined$PassDirectionDefYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   PassDirectionDefEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(PassDirectionCombined$PassDirectionDefEfficiencyPerc, na.rm = TRUE)) / (max(PassDirectionCombined$PassDirectionDefEfficiencyPerc, na.rm = TRUE) - min(PassDirectionCombined$PassDirectionDefEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("PassDirectionOffPlays", "PassDirectionOffEfficiency", "PassDirectionOffEfficiencyPerc", "PassDirectionOffYPP")),
                   colGroup(name = "Defense", columns = c("PassDirectionDefPlays", "PassDirectionDefEfficiency", "PassDirectionDefEfficiencyPerc", "PassDirectionDefYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## Missed Tackles
```{r, echo= FALSE, warning=FALSE, message = FALSE}
MissTacklePlaysOff = FBSOff %>% filter(!is.na(missed_tackle)) %>% group_by(OffTeamName) %>%
  summarize(MissTacklePlaysOff = n()) %>% rename(TeamName = OffTeamName)
MissTacklePlaysOff <- merge(MissTacklePlaysOff, TotalPlaysOff, all.x = TRUE)
MissTacklePlaysOff <- MissTacklePlaysOff %>% mutate(MissTacklePercOff = MissTacklePlaysOff/TotalPlaysOff, MissTacklePlaysOffRank = rank(desc(MissTacklePlaysOff), ties.method="first")) 
MissTacklePlaysDef = FBSDef %>% filter(!is.na(missed_tackle)) %>% group_by(DefTeamName) %>%
  summarize(MissTacklePlaysDef = n()) %>% rename(TeamName = DefTeamName)
MissTacklePlaysDef <- merge(MissTacklePlaysDef, TotalPlaysDef, all.x = TRUE)
MissTacklePlaysDef <- MissTacklePlaysDef %>% mutate(MissTacklePercDef = MissTacklePlaysDef/TotalPlaysDef, MissTacklePlaysDefRank = rank(MissTacklePlaysDef, ties.method="first")) 

MissTackleCombined = merge(MissTacklePlaysOff, MissTacklePlaysDef, all.x = TRUE) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode) 

tbl <- reactable(MissTackleCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                                style = sticky_style, filterable = FALSE,
                                name = "",
                                headerStyle = sticky_style,
                                cell = function(value) {
                                  div(
                                    class = "team",
                                    img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value))
                                       )
                                     }
                   ),
                   
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   
                   MissTacklePlaysOffRank = colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   MissTacklePlaysDefRank = colDef(name = "Rk", width = 50, class = "record1", align = "center"),
                   
                   MissTacklePlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "MT Plays Off"),
                   
                   TotalPlaysOff = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Off Plays"),
                   
                   MissTacklePercOff = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off MT %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                         style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MissTackleCombined$MissTacklePercOff, na.rm = TRUE)) / (max(MissTackleCombined$MissTacklePercOff, na.rm = TRUE) - min(MissTackleCombined$MissTacklePercOff, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   MissTacklePlaysDef = colDef(align = "center",width = 75,name = "MT Plays Def"),
                   
                   TotalPlaysDef = colDef(align = "center",width = 75,name = "Total Def Plays"),
                                     
                   MissTacklePercDef = colDef(width = 75, align = "center", name = "Def MT %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                     style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(MissTackleCombined$MissTacklePercDef, na.rm = TRUE)) / (max(MissTackleCombined$MissTacklePercDef, na.rm = TRUE) - min(MissTackleCombined$MissTacklePercDef, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("MissTacklePlaysOff", "TotalPlaysOff", "MissTacklePercOff", "MissTacklePlaysOffRank")),
                   colGroup(name = "Defense", columns = c("MissTacklePlaysDef", "TotalPlaysDef", "MissTacklePercDef", "MissTacklePlaysDefRank"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## Quarter Breakdown
```{r, echo= FALSE, warning=FALSE, message = FALSE}
QuarterOff <- FBSOff %>% group_by(OffTeamName, quarter) %>% summarize(OffQuarterPlays = n(), OffQuarterEfficiency = sum(Efficient, na.rm = TRUE), OffQuarterEfficiencyPerc = mean(Efficient, na.rm = TRUE), OffQuarterYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(Quarter = quarter, TeamName = OffTeamName)
QuarterDef <- FBSDef %>% group_by(DefTeamName, quarter) %>% summarize(DefQuarterPlays = n(), DefQuarterEfficiency = sum(Efficient, na.rm = TRUE), DefQuarterEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefQuarterYPP = mean(Gain.Loss, na.rm = TRUE)) %>% rename(Quarter = quarter, TeamName = DefTeamName)

QuarterCombined <- merge(QuarterOff, QuarterDef, by = c("TeamName", "Quarter")) %>% filter(Quarter %in% c(1,2,3,4)) %>% merge(dat1, all.x = TRUE) %>% select(-TeamCode, -PrimaryColor, -SecondaryColor) %>% relocate(teamcode, .after = TeamName) %>% merge(GamesPlayed, all.x = TRUE) %>% relocate(GamesPlayed, .after = teamcode)

tbl <- reactable(QuarterCombined,
                 columns = list(
                   teamcode = colDef(align = "center", width = 75,
                       style = sticky_style, filterable = FALSE,
                       name = "",
                       headerStyle = sticky_style,
                       cell = function(value) {
                         div(
                           class = "team",
                           img(class = "flag", alt = paste(value, "logo"), src = sprintf("http://a.espncdn.com/i/teamlogos/ncaa/500/%s.png", value)))}),
                   
                   TeamName = colDef(name = "Team", width = 150, filterable = TRUE, class = "team-name", align = "left"),
                   Conf = colDef(name = "Conf", width = 100, filterable = TRUE, class = "team-name", align = "center"),
                   GamesPlayed = colDef(defaultSortOrder = "desc", name = "Games", width = 100, filterable = FALSE, align = "center"),
                   Quarter = colDef(name = "Quarter", filterable = TRUE, width = 100, class = "team-name", align = "center"),

                   OffQuarterPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Play #"),
                   
                   OffQuarterEfficiency = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Off Eff Plays"),
                   
                   OffQuarterYPP = colDef(defaultSortOrder = "desc", name = "Off YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QuarterCombined$OffQuarterYPP, na.rm = TRUE)) / (max(QuarterCombined$OffQuarterYPP, na.rm = TRUE) - min(QuarterCombined$OffQuarterYPP, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
                   
                   OffQuarterEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Off Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QuarterCombined$OffQuarterEfficiencyPerc, na.rm = TRUE)) / (max(QuarterCombined$OffQuarterEfficiencyPerc, na.rm = TRUE) - min(QuarterCombined$OffQuarterEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_good(normalized)}
                        list(background = color)}),
            
                   DefQuarterPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Def Play #"),
                   
                   DefQuarterEfficiency = colDef(align = "center",width = 75,name = "Def Eff Plays"),
                   
                   DefQuarterYPP = colDef(name = "Def YPP", align = "center", width = 75,
                     format = colFormat(digits = 1), 
                     footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                      style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QuarterCombined$DefQuarterYPP, na.rm = TRUE)) / (max(QuarterCombined$DefQuarterYPP, na.rm = TRUE) - min(QuarterCombined$DefQuarterYPP, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)}),
                   
                   DefQuarterEfficiencyPerc = colDef(width = 75, align = "center", name = "Def Eff %", format = colFormat(percent = TRUE, digits = 1), 
                     footer = function(values, digits = 1) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                       style = function(value) {
                     if (is.na(value)) {
                       color <- "#A9A9A9"}
                     else { normalized <- (value - min(QuarterCombined$DefQuarterEfficiencyPerc, na.rm = TRUE)) / (max(QuarterCombined$DefQuarterEfficiencyPerc, na.rm = TRUE) - min(QuarterCombined$DefQuarterEfficiencyPerc, na.rm = TRUE))
                        color <- col_pal_bad(normalized)}
                        list(background = color)})),
                 
                 columnGroups = list(
                   colGroup(name = "Offense", columns = c("OffQuarterPlays", "OffQuarterEfficiency", "OffQuarterEfficiencyPerc", "OffQuarterYPP")),
                   colGroup(name = "Defense", columns = c("DefQuarterPlays", "DefQuarterEfficiency", "DefQuarterEfficiencyPerc", "DefQuarterYPP"))),
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)



```

## UVA Off Skill Groupings
```{r, echo= FALSE, warning=FALSE, message = FALSE}
PersonnelGroupings <- FBSOff %>% filter(OffTeamName == "Virginia") %>% group_by(offensive_personnel_skill) %>% 
  summarize(Plays = n(), EfficientPlays = sum(Efficient, na.rm = TRUE), OverallPersEfficiency = mean(Efficient, na.rm = TRUE), OverallPersYPP = mean(Gain.Loss, na.rm = TRUE))

PersonnelGroupings <- na.omit(PersonnelGroupings)
tbl <- reactable(PersonnelGroupings,
                 columns = list(
                   offensive_personnel_skill = colDef(name = "Skill Players", filterable = TRUE, style = sticky_style, headerStyle = sticky_style, width = 400, class = "team-name", align = "left"),
                  
                   Plays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Total Plays"),
                   
                   EfficientPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Eff Plays"),
                   
                    OverallPersYPP = colDef(defaultSortOrder = "desc", name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(PersonnelGroupings$OverallPersYPP))/(max(PersonnelGroupings$OverallPersYPP) - min(PersonnelGroupings$OverallPersYPP))
                      color <- col_pal_good(normalized)
                      list(background = color)
                       }),
                   
                   OverallPersEfficiency = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value){
                            normalized <- (value - min(PersonnelGroupings$OverallPersEfficiency))/(max(PersonnelGroupings$OverallPersEfficiency) - min(PersonnelGroupings$OverallPersEfficiency))
                            color <- col_pal_good(normalized)
                             list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```

## UVA Off Personnel Group
```{r, echo= FALSE, warning=FALSE, message = FALSE}
VirginiaPers <- FBSOff %>% filter(OffTeamName == "Virginia") %>% group_by(offensive_personnel_basic) %>% summarize(Plays = n(), YPP = mean(Gain.Loss, na.rm = TRUE), EffPerc = mean(Efficient, na.rm = TRUE), RunPlays = sum(run_pass == "R", na.rm = TRUE), YdsPerRush = mean(Gain.Loss[run_pass == "R"], na.rm = TRUE), PassPlays = sum(run_pass == "P", na.rm = TRUE), YdsPerPass = mean(Gain.Loss[run_pass == "P"], na.rm = TRUE)) %>%
  mutate(RunPerc = RunPlays / Plays, PassPerc = PassPlays/Plays) %>% relocate(RunPerc, .after = YdsPerRush)




VirginiaPers <- na.omit(VirginiaPers)
tbl <- reactable(VirginiaPers,
                 columns = list(
                   offensive_personnel_basic = colDef(name = "Offensive Personnel", style = sticky_style, headerStyle = sticky_style, width = 125, class = "team-name", align = "left"),
                  
                   Plays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Plays"),
                   RunPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Run Plays"),
                   PassPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Pass Plays"),
                   
                    YPP = colDef(defaultSortOrder = "desc", name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(VirginiaPers$YPP))/(max(VirginiaPers$YPP) - min(VirginiaPers$YPP))
                      color <- col_pal_good(normalized)
                      list(background = color)
                       }),
                   
                   YdsPerRush = colDef(defaultSortOrder = "desc", name = "Yds / Rush", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(VirginiaPers$YdsPerRush))/(max(VirginiaPers$YdsPerRush) - min(VirginiaPers$YdsPerRush))
                      color <- col_pal_good(normalized)
                      list(background = color)
                       }),
                   
                   YdsPerPass = colDef(defaultSortOrder = "desc", name = "Yds / Pass", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(VirginiaPers$YdsPerPass))/(max(VirginiaPers$YdsPerPass) - min(VirginiaPers$YdsPerPass))
                      color <- col_pal_good(normalized)
                      list(background = color)
                       }),
                   
                   RunPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Run %", format = colFormat(percent = TRUE, digits = 1)), 
                    
                   PassPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Pass %", format = colFormat(percent = TRUE, digits = 1)),
                   
                   EffPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value){
                            normalized <- (value - min(VirginiaPers$EffPerc))/(max(VirginiaPers$EffPerc) - min(VirginiaPers$EffPerc))
                            color <- col_pal_good(normalized)
                             list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## UVA Def Groups
```{r, echo= FALSE, warning=FALSE, message = FALSE}
VirginiaDefSimple <- FBSDef %>% filter(DefTeamName == "Virginia") %>% group_by(defensive_personnel) %>% summarize(DefPersPlays = n(), DefPersPlaysEfficiency = sum(Efficient, na.rm = TRUE), DefPersPlaysEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefPersPlaysYPP = mean(Gain.Loss, na.rm = TRUE))

VirginiaDefSimple <- na.omit(VirginiaDefSimple)
tbl <- reactable(VirginiaDefSimple,
                 columns = list(
                   defensive_personnel = colDef(name = "Defensive Group", style = sticky_style, headerStyle = sticky_style, width = 125, class = "team-name", align = "left"),
                  
                   DefPersPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Plays"),
                   
                   DefPersPlaysEfficiency = colDef(align = "center",width = 75,name = "Eff Plays"),
                   
                    DefPersPlaysYPP = colDef(name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(VirginiaDefSimple$DefPersPlaysYPP))/(max(VirginiaDefSimple$DefPersPlaysYPP) - min(VirginiaDefSimple$DefPersPlaysYPP))
                      color <- col_pal_bad(normalized)
                      list(background = color)
                       }),
                   
                   DefPersPlaysEfficiencyPerc = colDef(defaultSortOrder = "desc", width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value){
                            normalized <- (value - min(VirginiaDefSimple$DefPersPlaysEfficiencyPerc))/(max(VirginiaDefSimple$DefPersPlaysEfficiencyPerc) - min(VirginiaDefSimple$DefPersPlaysEfficiencyPerc))
                            color <- col_pal_bad(normalized)
                             list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)


```

## Def Grouping vs Off Personnel
```{r, echo= FALSE, warning=FALSE, message = FALSE}
DefPersVsOffPers <- FBSDef %>% filter(DefTeamName == "Virginia") %>% group_by(defensive_personnel, offensive_personnel_basic) %>% summarize(DefPersVsOffPersPlays = n(), DefPersVsOffPersPlaysEfficiency = sum(Efficient, na.rm = TRUE), DefPersVsOffPersPersPlaysEfficiencyPerc = mean(Efficient, na.rm = TRUE), DefPersVsOffPersPersPlaysYPP = mean(Gain.Loss, na.rm = TRUE))

DefPersVsOffPers <- na.omit(DefPersVsOffPers)
tbl <- reactable(DefPersVsOffPers,
                 columns = list(
                   defensive_personnel = colDef(name = "Defensive Group", filterable = TRUE, style = sticky_style, headerStyle = sticky_style, width = 125, class = "team-name", align = "left"),
                  
                   offensive_personnel_basic = colDef(align = "center",width = 75,name = "Off Pers"),
                   
                   DefPersVsOffPersPlays = colDef(defaultSortOrder = "desc", align = "center",width = 75,name = "Plays"),
                   
                   DefPersVsOffPersPlaysEfficiency = colDef(align = "center",width = 75,name = "Eff Plays"),
                   
                    DefPersVsOffPersPersPlaysYPP = colDef(name = "YPP", align = "center", width = 75,
                    format = colFormat(digits = 1), 
                    footer = function(values) {
                       htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))
                        },
                      style = function(value){
                      normalized <- (value - min(DefPersVsOffPers$DefPersVsOffPersPersPlaysYPP))/(max(DefPersVsOffPers$DefPersVsOffPersPersPlaysYPP) - min(DefPersVsOffPers$DefPersVsOffPersPersPlaysYPP))
                      color <- col_pal_bad(normalized)
                      list(background = color)
                       }),
                   
                   DefPersVsOffPersPersPlaysEfficiencyPerc = colDef(width = 75, align = "center", name = "Eff %", format = colFormat(percent = TRUE, digits = 1), 
                       footer = function(values, digits = 1) {
                          htmltools::tags$b(sprintf("%.1f", mean(values, na.rm = TRUE)))},
                          style = function(value){
                            normalized <- (value - min(DefPersVsOffPers$DefPersVsOffPersPersPlaysEfficiencyPerc))/(max(DefPersVsOffPers$DefPersVsOffPersPersPlaysEfficiencyPerc) - min(DefPersVsOffPers$DefPersVsOffPersPersPlaysEfficiencyPerc))
                            color <- col_pal_bad(normalized)
                             list(background = color)})),
                 
                 bordered = TRUE,
                 highlight = TRUE,
                 searchable = TRUE,
                 showPageSizeOptions = TRUE, 
                 pageSizeOptions = c(25, 50, 100), 
                 defaultPageSize = 25,
                 striped = TRUE)

div(class = "standings",
  tbl
)

```


```{css, echo=FALSE}
.border-left {
  border-left: 3px solid #555;
}

.standings {
  font-family: Karla, "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 18px;
}

.title h2 {
  font-size: 20px;
  font-weight: 600;
}

.header {
  border-bottom-color: #555;
  font-size: 13px;
  font-weight: 400;
  text-transform: uppercase;
}

.flag {
  margin-right: 8px;
  height: 35px;
}

.team-name {
  font-size: 14px;
  font-weight: 700;
}

.record {
  margin-left: 5px;
  color: #999;
  font-size: 13px;
}

.record1 {
  font-size: 14px;
  text-align: middle;
}

h1.title {
  font-size: 38px;
  font-family: Karla, "Helvetica Neue", Helvetica, Arial, sans-serif;
  text-align: center;
}

.header1 {
  padding: 20px;
  text-align: left;
  background: #4d0099;
  color: white;
  font-size: 30px;
  font-family: Karla, "Helvetica Neue", Helvetica, Arial, sans-serif;
}
```

